<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: nrf51_beacon/common/sdk_modified/dfu_dual_bank/dfu_dual_bank_mod.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dfu__dual__bank__mod_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dfu_dual_bank_mod.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;stddef.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="dfu_8h_source.html">dfu.h</a>&quot;</code><br/>
<code>#include &quot;dfu_types.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="dfu__bank__internal_8h_source.html">dfu_bank_internal.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf_8h_source.html">nrf.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf51_8h_source.html">nrf51.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf51__bitfields_8h_source.html">nrf51_bitfields.h</a>&quot;</code><br/>
<code>#include &quot;app_util.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf__sdm_8h_source.html">nrf_sdm.h</a>&quot;</code><br/>
<code>#include &quot;app_error.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf__error_8h_source.html">nrf_error.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app__timer_8h_source.html">app_timer.h</a>&quot;</code><br/>
<code>#include &quot;nordic_common.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="bootloader_8h_source.html">bootloader.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bootloader__types_8h_source.html">bootloader_types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pstorage_8h_source.html">pstorage.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf__mbr_8h_source.html">nrf_mbr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dfu__init_8h_source.html">dfu_init.h</a>&quot;</code><br/>
</div>
<p><a href="dfu__dual__bank__mod_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac06b13079d6ba8377eed0736c530a2d0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#ac06b13079d6ba8377eed0736c530a2d0">pstorage_callback_handler</a> (pstorage_handle_t *p_handle, uint8_t op_code, uint32_t result, uint8_t *p_data, uint32_t data_len)</td></tr>
<tr class="memdesc:ac06b13079d6ba8377eed0736c530a2d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling callbacks from pstorage module.  <a href="#ac06b13079d6ba8377eed0736c530a2d0">More...</a><br/></td></tr>
<tr class="separator:ac06b13079d6ba8377eed0736c530a2d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af94b4625aba72b5bacb4a87d2e625842"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#af94b4625aba72b5bacb4a87d2e625842">dfu_timeout_handler</a> (void *p_context)</td></tr>
<tr class="memdesc:af94b4625aba72b5bacb4a87d2e625842"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling the DFU timeout.  <a href="#af94b4625aba72b5bacb4a87d2e625842">More...</a><br/></td></tr>
<tr class="separator:af94b4625aba72b5bacb4a87d2e625842"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7acb2db272a0e8293104c7c4ab05dbd6"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a7acb2db272a0e8293104c7c4ab05dbd6">dfu_timer_restart</a> (void)</td></tr>
<tr class="memdesc:a7acb2db272a0e8293104c7c4ab05dbd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for restarting the DFU Timer.  <a href="#a7acb2db272a0e8293104c7c4ab05dbd6">More...</a><br/></td></tr>
<tr class="separator:a7acb2db272a0e8293104c7c4ab05dbd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4378cae309fa9e631dcf8c9c4863740f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a4378cae309fa9e631dcf8c9c4863740f">dfu_prepare_func_app_erase</a> (uint32_t image_size)</td></tr>
<tr class="memdesc:a4378cae309fa9e631dcf8c9c4863740f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for preparing of flash before receiving SoftDevice image.  <a href="#a4378cae309fa9e631dcf8c9c4863740f">More...</a><br/></td></tr>
<tr class="separator:a4378cae309fa9e631dcf8c9c4863740f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eacc294cba894538e2b066c05af9b29"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a4eacc294cba894538e2b066c05af9b29">dfu_prepare_func_swap_erase</a> (uint32_t image_size)</td></tr>
<tr class="memdesc:a4eacc294cba894538e2b066c05af9b29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for preparing swap before receiving application or bootloader image.  <a href="#a4eacc294cba894538e2b066c05af9b29">More...</a><br/></td></tr>
<tr class="separator:a4eacc294cba894538e2b066c05af9b29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0288d992c1b3eba4577d3df02ba05e5e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a0288d992c1b3eba4577d3df02ba05e5e">dfu_cleared_func_swap</a> (void)</td></tr>
<tr class="memdesc:a0288d992c1b3eba4577d3df02ba05e5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling behaviour when clear operation has completed.  <a href="#a0288d992c1b3eba4577d3df02ba05e5e">More...</a><br/></td></tr>
<tr class="separator:a0288d992c1b3eba4577d3df02ba05e5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c5d147b2cd4c7c74f3633e5a691bdac"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a6c5d147b2cd4c7c74f3633e5a691bdac">dfu_cleared_func_app</a> (void)</td></tr>
<tr class="memdesc:a6c5d147b2cd4c7c74f3633e5a691bdac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling behaviour when clear operation has completed.  <a href="#a6c5d147b2cd4c7c74f3633e5a691bdac">More...</a><br/></td></tr>
<tr class="separator:a6c5d147b2cd4c7c74f3633e5a691bdac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad803e89d8be71bf4e12537fd4c19a50c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#ad803e89d8be71bf4e12537fd4c19a50c">offset_calculate</a> (uint32_t sd_image_size)</td></tr>
<tr class="memdesc:ad803e89d8be71bf4e12537fd4c19a50c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for calculating storage offset for receiving SoftDevice image.  <a href="#ad803e89d8be71bf4e12537fd4c19a50c">More...</a><br/></td></tr>
<tr class="separator:ad803e89d8be71bf4e12537fd4c19a50c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7624bda87becd80331c53f5ddc7c66e7"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a7624bda87becd80331c53f5ddc7c66e7">dfu_activate_sd</a> (void)</td></tr>
<tr class="memdesc:a7624bda87becd80331c53f5ddc7c66e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for activating received SoftDevice image.  <a href="#a7624bda87becd80331c53f5ddc7c66e7">More...</a><br/></td></tr>
<tr class="separator:a7624bda87becd80331c53f5ddc7c66e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b640fb4507021d82976ee1b7a0d6a1e"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a6b640fb4507021d82976ee1b7a0d6a1e">dfu_activate_app</a> (void)</td></tr>
<tr class="memdesc:a6b640fb4507021d82976ee1b7a0d6a1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for activating received Application image.  <a href="#a6b640fb4507021d82976ee1b7a0d6a1e">More...</a><br/></td></tr>
<tr class="separator:a6b640fb4507021d82976ee1b7a0d6a1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13007bebf529dcd5d583c09e09fc5a49"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a13007bebf529dcd5d583c09e09fc5a49">dfu_activate_bl</a> (void)</td></tr>
<tr class="memdesc:a13007bebf529dcd5d583c09e09fc5a49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for activating received Bootloader image.  <a href="#a13007bebf529dcd5d583c09e09fc5a49">More...</a><br/></td></tr>
<tr class="separator:a13007bebf529dcd5d583c09e09fc5a49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga04aa562312c46cd022b4d4acc7318452"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga04aa562312c46cd022b4d4acc7318452">dfu_init</a> (void)</td></tr>
<tr class="memdesc:ga04aa562312c46cd022b4d4acc7318452"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the Device Firmware Update module.  <a href="group__nrf__dfu.html#ga04aa562312c46cd022b4d4acc7318452">More...</a><br/></td></tr>
<tr class="separator:ga04aa562312c46cd022b4d4acc7318452"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac459a6787392cac2da15bc87ce7b99c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gac459a6787392cac2da15bc87ce7b99c9">dfu_register_callback</a> (<a class="el" href="group__nrf__dfu.html#gaacc31c43e887f7b9f1f462b39f5171c2">dfu_callback_t</a> callback_handler)</td></tr>
<tr class="memdesc:gac459a6787392cac2da15bc87ce7b99c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for registering a callback listener for <a class="el" href="group__nrf__dfu.html#gaedeca60961c137dbc070c9acba09126f">dfu_data_pkt_handle</a> callbacks.  <a href="group__nrf__dfu.html#gac459a6787392cac2da15bc87ce7b99c9">More...</a><br/></td></tr>
<tr class="separator:gac459a6787392cac2da15bc87ce7b99c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ca360d2f4d3e5847815e3b78ee00786"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga3ca360d2f4d3e5847815e3b78ee00786">dfu_start_pkt_handle</a> (<a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *p_packet)</td></tr>
<tr class="memdesc:ga3ca360d2f4d3e5847815e3b78ee00786"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for setting the DFU image size.  <a href="group__nrf__dfu.html#ga3ca360d2f4d3e5847815e3b78ee00786">More...</a><br/></td></tr>
<tr class="separator:ga3ca360d2f4d3e5847815e3b78ee00786"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaedeca60961c137dbc070c9acba09126f"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaedeca60961c137dbc070c9acba09126f">dfu_data_pkt_handle</a> (<a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *p_packet)</td></tr>
<tr class="memdesc:gaedeca60961c137dbc070c9acba09126f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling DFU data packets.  <a href="group__nrf__dfu.html#gaedeca60961c137dbc070c9acba09126f">More...</a><br/></td></tr>
<tr class="separator:gaedeca60961c137dbc070c9acba09126f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7029a93e35d44f50a82aacd001069893"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga7029a93e35d44f50a82aacd001069893">dfu_init_pkt_complete</a> (void)</td></tr>
<tr class="memdesc:ga7029a93e35d44f50a82aacd001069893"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling DFU init packet complete.  <a href="group__nrf__dfu.html#ga7029a93e35d44f50a82aacd001069893">More...</a><br/></td></tr>
<tr class="separator:ga7029a93e35d44f50a82aacd001069893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a7187ec97973d70e1f0d3d9a1747052"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga0a7187ec97973d70e1f0d3d9a1747052">dfu_init_pkt_handle</a> (<a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *p_packet)</td></tr>
<tr class="memdesc:ga0a7187ec97973d70e1f0d3d9a1747052"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling DFU init packets.  <a href="group__nrf__dfu.html#ga0a7187ec97973d70e1f0d3d9a1747052">More...</a><br/></td></tr>
<tr class="separator:ga0a7187ec97973d70e1f0d3d9a1747052"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga025b98379882ab47f9a2585dce60e34c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga025b98379882ab47f9a2585dce60e34c">dfu_image_validate</a> ()</td></tr>
<tr class="memdesc:ga025b98379882ab47f9a2585dce60e34c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating a transferred image after the transfer has completed.  <a href="group__nrf__dfu.html#ga025b98379882ab47f9a2585dce60e34c">More...</a><br/></td></tr>
<tr class="separator:ga025b98379882ab47f9a2585dce60e34c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaa8227795cc1e3d231d2114f79a9017c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaaa8227795cc1e3d231d2114f79a9017c">dfu_image_activate</a> ()</td></tr>
<tr class="memdesc:gaaa8227795cc1e3d231d2114f79a9017c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for activating the transfered image after validation has successfully completed.  <a href="group__nrf__dfu.html#gaaa8227795cc1e3d231d2114f79a9017c">More...</a><br/></td></tr>
<tr class="separator:gaaa8227795cc1e3d231d2114f79a9017c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3428f74b8abe841939414cd8669dc017"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga3428f74b8abe841939414cd8669dc017">dfu_reset</a> (void)</td></tr>
<tr class="memdesc:ga3428f74b8abe841939414cd8669dc017"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for reseting the current update procedure and return to initial state.  <a href="group__nrf__dfu.html#ga3428f74b8abe841939414cd8669dc017">More...</a><br/></td></tr>
<tr class="separator:ga3428f74b8abe841939414cd8669dc017"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2956cfc015c2540bed09f59f8627f9c"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#ac2956cfc015c2540bed09f59f8627f9c">dfu_compare_block</a> (uint32_t *ptr1, uint32_t *ptr2, uint32_t len)</td></tr>
<tr class="separator:ac2956cfc015c2540bed09f59f8627f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69622e0a575a79baa350512c0ebd9bb7"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a69622e0a575a79baa350512c0ebd9bb7">dfu_copy_sd</a> (uint32_t *src, uint32_t *dst, uint32_t len)</td></tr>
<tr class="separator:a69622e0a575a79baa350512c0ebd9bb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add37ea8686866d90e3122acd659f6945"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#add37ea8686866d90e3122acd659f6945">dfu_sd_img_block_swap</a> (uint32_t *src, uint32_t *dst, uint32_t len, uint32_t block_size)</td></tr>
<tr class="separator:add37ea8686866d90e3122acd659f6945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac5f2b2c8faf704d6e2be18df05ceee1b"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gac5f2b2c8faf704d6e2be18df05ceee1b">dfu_sd_image_swap</a> (void)</td></tr>
<tr class="memdesc:gac5f2b2c8faf704d6e2be18df05ceee1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for swapping existing SoftDevice with newly received.  <a href="group__nrf__dfu.html#gac5f2b2c8faf704d6e2be18df05ceee1b">More...</a><br/></td></tr>
<tr class="separator:gac5f2b2c8faf704d6e2be18df05ceee1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa5c719005d3cb149dc8af672c8782037"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaa5c719005d3cb149dc8af672c8782037">dfu_bl_image_swap</a> (void)</td></tr>
<tr class="memdesc:gaa5c719005d3cb149dc8af672c8782037"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for swapping existing bootloader with newly received.  <a href="group__nrf__dfu.html#gaa5c719005d3cb149dc8af672c8782037">More...</a><br/></td></tr>
<tr class="separator:gaa5c719005d3cb149dc8af672c8782037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga46075f420f41e2c6fe102a07e0def6e9"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga46075f420f41e2c6fe102a07e0def6e9">dfu_bl_image_validate</a> (void)</td></tr>
<tr class="memdesc:ga46075f420f41e2c6fe102a07e0def6e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating that new bootloader has been correctly installed.  <a href="group__nrf__dfu.html#ga46075f420f41e2c6fe102a07e0def6e9">More...</a><br/></td></tr>
<tr class="separator:ga46075f420f41e2c6fe102a07e0def6e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4d1fb87fd6d01940f8c69cfc08d74cb9"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga4d1fb87fd6d01940f8c69cfc08d74cb9">dfu_sd_image_validate</a> (void)</td></tr>
<tr class="memdesc:ga4d1fb87fd6d01940f8c69cfc08d74cb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating that new SoftDevicehas been correctly installed.  <a href="group__nrf__dfu.html#ga4d1fb87fd6d01940f8c69cfc08d74cb9">More...</a><br/></td></tr>
<tr class="separator:ga4d1fb87fd6d01940f8c69cfc08d74cb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3094a1e41850cba934bab311af4a1e0b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__dfu__bank__internal.html#ga187dfde3b0fa8047e6c97b2317bce21f">dfu_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a></td></tr>
<tr class="separator:a3094a1e41850cba934bab311af4a1e0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab00a58089a8128240922402f85448953"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a></td></tr>
<tr class="separator:ab00a58089a8128240922402f85448953"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5439994e2f6fb1042537c1fed855c6a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structdfu__start__packet__t.html">dfu_start_packet_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a></td></tr>
<tr class="separator:ac5439994e2f6fb1042537c1fed855c6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c48b18efe48b24a967f064ffe921e77"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a1c48b18efe48b24a967f064ffe921e77">m_init_packet</a> [64]</td></tr>
<tr class="separator:a1c48b18efe48b24a967f064ffe921e77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3199edc3ad38b9ba7ff9db196f910b95"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a></td></tr>
<tr class="separator:a3199edc3ad38b9ba7ff9db196f910b95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfc241c56dd7f007af1567c3303351c7"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#adfc241c56dd7f007af1567c3303351c7">m_image_crc</a></td></tr>
<tr class="separator:adfc241c56dd7f007af1567c3303351c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fe6be7ea6e5f34a06da0e43ce6ff1a4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__app__timer.html#gad024aa9066b1ca640dd171d83ee39290">app_timer_id_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a3fe6be7ea6e5f34a06da0e43ce6ff1a4">m_dfu_timer_id</a></td></tr>
<tr class="separator:a3fe6be7ea6e5f34a06da0e43ce6ff1a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad431bbfbae1cea8daed650e9b94f40e1"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#ad431bbfbae1cea8daed650e9b94f40e1">m_dfu_timed_out</a> = false</td></tr>
<tr class="separator:ad431bbfbae1cea8daed650e9b94f40e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44f5af9763e456aea3551f638ffa0eac"><td class="memItemLeft" align="right" valign="top">static pstorage_handle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a44f5af9763e456aea3551f638ffa0eac">m_storage_handle_swap</a></td></tr>
<tr class="separator:a44f5af9763e456aea3551f638ffa0eac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b3f1c9689128450bf4003909457db43"><td class="memItemLeft" align="right" valign="top">static pstorage_handle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a></td></tr>
<tr class="separator:a6b3f1c9689128450bf4003909457db43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a21c12ec66e61f99824b0a24720494e"><td class="memItemLeft" align="right" valign="top">static pstorage_handle_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a0a21c12ec66e61f99824b0a24720494e">mp_storage_handle_active</a></td></tr>
<tr class="separator:a0a21c12ec66e61f99824b0a24720494e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01cb0b09fdb4844a87e99787e65eb3ca"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__nrf__dfu.html#gaacc31c43e887f7b9f1f462b39f5171c2">dfu_callback_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a01cb0b09fdb4844a87e99787e65eb3ca">m_data_pkt_cb</a></td></tr>
<tr class="separator:a01cb0b09fdb4844a87e99787e65eb3ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9501c0d8f1327a64b9a2bbf5a87bcdc3"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structdfu__bank__func__t.html">dfu_bank_func_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a></td></tr>
<tr class="separator:a9501c0d8f1327a64b9a2bbf5a87bcdc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac06b13079d6ba8377eed0736c530a2d0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pstorage_callback_handler </td>
          <td>(</td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>op_code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>data_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for handling callbacks from pstorage module. </p>
<p>Handles pstorage results for clear and storage operation. For detailed description of the parameters provided with the callback, please refer to <a class="el" href="group__pstorage__data__types.html#gaac1d429f24eb2850da6d8f8773a14c47">pstorage_ntf_cb_t</a>. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00059">59</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__bank__internal_8h_source.html#l00079">dfu_bank_func_t::cleared</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00075">DATA_PACKET</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00035">DFU_STATE_PREPARING</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00036">DFU_STATE_RDY</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00038">DFU_STATE_RX_DATA_PKT</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00050">m_data_pkt_cb</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="pstorage_8h_source.html#l00044">PSTORAGE_CLEAR_OP_CODE</a>, <a class="el" href="pstorage_8h_source.html#l00042">PSTORAGE_STORE_OP_CODE</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00074">START_PACKET</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">switch</span> (op_code)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__ps__opcode.html#gad1415b8815fc4e0ba8f4f6bc2d8e3ce6">PSTORAGE_STORE_OP_CODE</a>:</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> == <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa475955163ace358b9373c0b3a87ce4ec">DFU_STATE_RX_DATA_PKT</a>) &amp;&amp; (<a class="code" href="dfu__dual__bank__mod_8c.html#a01cb0b09fdb4844a87e99787e65eb3ca">m_data_pkt_cb</a> != NULL))</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <a class="code" href="dfu__dual__bank__mod_8c.html#a01cb0b09fdb4844a87e99787e65eb3ca">m_data_pkt_cb</a>(<a class="code" href="group__nrf__dfu__types.html#ga86e7dedb53f2e6ef40f80f6189bb6fe9">DATA_PACKET</a>, result, p_data);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__ps__opcode.html#gaf2ce8b4e460358a23ae82516167df79c">PSTORAGE_CLEAR_OP_CODE</a>:</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> == <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa539947bf7a53147eff081ef153818b8d">DFU_STATE_PREPARING</a>)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a64703274c55080c0a7374432804d9d11">cleared</a>();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa43c819e2e2d6cb79f0cc3e9703df3b04">DFU_STATE_RDY</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a01cb0b09fdb4844a87e99787e65eb3ca">m_data_pkt_cb</a> != NULL)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                    <a class="code" href="dfu__dual__bank__mod_8c.html#a01cb0b09fdb4844a87e99787e65eb3ca">m_data_pkt_cb</a>(<a class="code" href="group__nrf__dfu__types.html#gafa9a52a3e6c43ccf00cf680f944d67a3">START_PACKET</a>, result, p_data);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    APP_ERROR_CHECK(result);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af94b4625aba72b5bacb4a87d2e625842"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dfu_timeout_handler </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_context</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for handling the DFU timeout. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_context</td><td>The timeout context. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00097">97</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00145">bootloader_dfu_update_process()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00127">DFU_TIMEOUT</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00044">m_dfu_timed_out</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00135">dfu_update_status_t::status_code</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    UNUSED_PARAMETER(p_context);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> update_status;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#ad431bbfbae1cea8daed650e9b94f40e1">m_dfu_timed_out</a>           = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a41de75b11fc5be19acc13404c22e9d90">status_code</a> = <a class="code" href="group__nrf__dfu__types.html#gga53842ec56bb0c14aa506551bfdc0c652a0e2b2bfbf1980322e38f326efa38a841">DFU_TIMEOUT</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef" title="Function for processing DFU status update. ">bootloader_dfu_update_process</a>(update_status);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7acb2db272a0e8293104c7c4ab05dbd6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_timer_restart </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for restarting the DFU Timer. </p>
<p>This function will stop and restart the DFU timer. This function will be called by the functions handling any DFU packet received from the peer that is transferring a firmware image. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00115">115</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="app__timer_8c_source.html#l01080">app_timer_start()</a>, <a class="el" href="app__timer_8c_source.html#l01109">app_timer_stop()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00044">DFU_TIMEOUT_INTERVAL</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00044">m_dfu_timed_out</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00043">m_dfu_timer_id</a>, and <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>.</p>
<div class="fragment"><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#ad431bbfbae1cea8daed650e9b94f40e1">m_dfu_timed_out</a>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">// The DFU timer had already timed out.</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    uint32_t err_code = <a class="code" href="group__app__timer.html#gad40fbb2a6a9e5bf7d00f838763f5514c" title="Function for stopping the specified timer. ">app_timer_stop</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#a3fe6be7ea6e5f34a06da0e43ce6ff1a4">m_dfu_timer_id</a>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    err_code = <a class="code" href="group__app__timer.html#ga03fb5f5fa85d16289db0d3c15bb0f24d" title="Function for starting a timer. ">app_timer_start</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#a3fe6be7ea6e5f34a06da0e43ce6ff1a4">m_dfu_timer_id</a>, <a class="code" href="group__dfu__bank__internal.html#gac852b26871e27db5896374b80d173ed7">DFU_TIMEOUT_INTERVAL</a>, NULL);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4378cae309fa9e631dcf8c9c4863740f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dfu_prepare_func_app_erase </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>image_size</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for preparing of flash before receiving SoftDevice image. </p>
<p>This function will erase current application area to ensure sufficient amount of storage for the SoftDevice image. Upon erase complete a callback will be done. See <a class="el" href="group__dfu__bank__internal.html#gaf68c07fc7834b9c16aae9a748f43bdc8">dfu_bank_prepare_t</a> for further details. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00139">139</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__bank__internal_8h_source.html#l00035">DFU_STATE_PREPARING</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00036">m_image_size</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00047">m_storage_handle_app</a>, and <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00048">mp_storage_handle_active</a>.</p>
<div class="fragment"><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a0a21c12ec66e61f99824b0a24720494e">mp_storage_handle_active</a> = &amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// Doing a SoftDevice update thus current application must be cleared to ensure enough space</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// for new SoftDevice.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa539947bf7a53147eff081ef153818b8d">DFU_STATE_PREPARING</a>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    err_code    = pstorage_raw_clear(&amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>, <a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4eacc294cba894538e2b066c05af9b29"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dfu_prepare_func_swap_erase </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>image_size</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for preparing swap before receiving application or bootloader image. </p>
<p>This function will erase current swap area to ensure flash is ready for storage of the Application or Bootloader image. Upon erase complete a callback will be done. See <a class="el" href="group__dfu__bank__internal.html#gaf68c07fc7834b9c16aae9a748f43bdc8">dfu_bank_prepare_t</a> for further details. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00159">159</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00062">DFU_IMAGE_MAX_SIZE_BANKED</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00035">DFU_STATE_PREPARING</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00046">m_storage_handle_swap</a>, and <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00048">mp_storage_handle_active</a>.</p>
<div class="fragment"><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;{</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a0a21c12ec66e61f99824b0a24720494e">mp_storage_handle_active</a> = &amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a44f5af9763e456aea3551f638ffa0eac">m_storage_handle_swap</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa539947bf7a53147eff081ef153818b8d">DFU_STATE_PREPARING</a>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    err_code    = pstorage_raw_clear(&amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a44f5af9763e456aea3551f638ffa0eac">m_storage_handle_swap</a>, <a class="code" href="group__nrf__dfu__types.html#gaa6268d940194dff6e27f45e76513267b">DFU_IMAGE_MAX_SIZE_BANKED</a>);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0288d992c1b3eba4577d3df02ba05e5e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dfu_cleared_func_swap </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for handling behaviour when clear operation has completed. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00173">173</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">//    dfu_update_status_t update_status = {DFU_BANK_1_ERASED, };</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">//    bootloader_dfu_update_process(update_status);</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6c5d147b2cd4c7c74f3633e5a691bdac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dfu_cleared_func_app </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for handling behaviour when clear operation has completed. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00182">182</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00145">bootloader_dfu_update_process()</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00126">DFU_BANK_0_ERASED</a>.</p>
<div class="fragment"><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> update_status = {<a class="code" href="group__nrf__dfu__types.html#gga53842ec56bb0c14aa506551bfdc0c652a4334cd4f468d0f560262f6af6202f711">DFU_BANK_0_ERASED</a>, };</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef" title="Function for processing DFU status update. ">bootloader_dfu_update_process</a>(update_status);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad803e89d8be71bf4e12537fd4c19a50c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t offset_calculate </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>sd_image_size</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for calculating storage offset for receiving SoftDevice image. </p>
<p>When a new SoftDevice is received it will be temporary stored in flash before moved to address 0x0. In order to succesfully validate transfer and relocation it is important that temporary image and final installed image does not ovwerlap hence an offset must be calculated in case new image is larger than currently installed SoftDevice. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00196">196</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00068">CODE_PAGE_SIZE</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00065">DFU_BANK_0_REGION_START</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00093">dfu_start_packet_t::sd_image_size</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    uint32_t offset = 0;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> &gt; <a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        uint32_t page_mask = (<a class="code" href="group__nrf__dfu__types.html#ga8b56633cd2604d9fae053b04ff288841">CODE_PAGE_SIZE</a> - 1);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        uint32_t diff = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> - <a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        offset = diff &amp; ~page_mask;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// Align offset to next page if image size is not page sized.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">if</span> ((diff &amp; page_mask) &gt; 0)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            offset += <a class="code" href="group__nrf__dfu__types.html#ga8b56633cd2604d9fae053b04ff288841">CODE_PAGE_SIZE</a>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">return</span> offset;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7624bda87becd80331c53f5ddc7c66e7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_activate_sd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for activating received SoftDevice image. </p>
<dl class="section note"><dt>Note</dt><dd>This function will not move the SoftDevice image. The bootloader settings will be marked as SoftDevice update complete and the swapping of current SoftDevice will occur after system reset.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00226">226</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00136">dfu_update_status_t::app_crc</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00095">dfu_start_packet_t::app_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00139">dfu_update_status_t::app_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00094">dfu_start_packet_t::bl_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00138">dfu_update_status_t::bl_size</a>, <a class="el" href="bootloader_8c_source.html#l00145">bootloader_dfu_update_process()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00065">DFU_BANK_0_REGION_START</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00123">DFU_UPDATE_SD_COMPLETE</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00041">m_image_crc</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00093">dfu_start_packet_t::sd_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00140">dfu_update_status_t::sd_image_start</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00137">dfu_update_status_t::sd_size</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00135">dfu_update_status_t::status_code</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;{</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> update_status;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a41de75b11fc5be19acc13404c22e9d90">status_code</a>    = <a class="code" href="group__nrf__dfu__types.html#gga53842ec56bb0c14aa506551bfdc0c652a726ca6074dabac21a84fa51ff2633429">DFU_UPDATE_SD_COMPLETE</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a7be71576fc41a0e19af12014fb4b8e5e">app_crc</a>        = <a class="code" href="dfu__dual__bank__mod_8c.html#adfc241c56dd7f007af1567c3303351c7">m_image_crc</a>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> = <a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a0b040f37b930d40a8541412c047ef4b6">sd_size</a>        = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#ac4532de3772b71ccfe7817006b0bb46d">bl_size</a>        = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#aaff20932440e5ee658dc80d50629755e">app_size</a>       = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef" title="Function for processing DFU status update. ">bootloader_dfu_update_process</a>(update_status);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6b640fb4507021d82976ee1b7a0d6a1e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_activate_app </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for activating received Application image. </p>
<p>This function will move the received application image fram swap (bank 1) to application area (bank 0).</p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success. Error code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00250">250</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00136">dfu_update_status_t::app_crc</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00095">dfu_start_packet_t::app_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00139">dfu_update_status_t::app_size</a>, <a class="el" href="bootloader_8c_source.html#l00145">bootloader_dfu_update_process()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00122">DFU_UPDATE_APP_COMPLETE</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00041">m_image_crc</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00047">m_storage_handle_app</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00046">m_storage_handle_swap</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00135">dfu_update_status_t::status_code</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;{</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Erase BANK 0.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    err_code = pstorage_raw_clear(&amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>, <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    err_code = pstorage_raw_store(&amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                  (uint8_t *)<a class="code" href="dfu__dual__bank__mod_8c.html#a44f5af9763e456aea3551f638ffa0eac">m_storage_handle_swap</a>.block_id,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                  <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                  0);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (err_code == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> update_status;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        memset(&amp;update_status, 0, <span class="keyword">sizeof</span>(<a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> ));</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        update_status.<a class="code" href="structdfu__update__status__t.html#a41de75b11fc5be19acc13404c22e9d90">status_code</a> = <a class="code" href="group__nrf__dfu__types.html#gga53842ec56bb0c14aa506551bfdc0c652a0cf80a65601f1f7085fd043aad7f4c3f">DFU_UPDATE_APP_COMPLETE</a>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        update_status.<a class="code" href="structdfu__update__status__t.html#a7be71576fc41a0e19af12014fb4b8e5e">app_crc</a>     = <a class="code" href="dfu__dual__bank__mod_8c.html#adfc241c56dd7f007af1567c3303351c7">m_image_crc</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        update_status.<a class="code" href="structdfu__update__status__t.html#aaff20932440e5ee658dc80d50629755e">app_size</a>    = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef" title="Function for processing DFU status update. ">bootloader_dfu_update_process</a>(update_status);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a13007bebf529dcd5d583c09e09fc5a49"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_activate_bl </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for activating received Bootloader image. </p>
<dl class="section note"><dt>Note</dt><dd>This function will not move the bootloader image. The bootloader settings will be marked as Bootloader update complete and the swapping of current bootloader will occur after system reset.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00287">287</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00136">dfu_update_status_t::app_crc</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00095">dfu_start_packet_t::app_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00139">dfu_update_status_t::app_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00094">dfu_start_packet_t::bl_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00138">dfu_update_status_t::bl_size</a>, <a class="el" href="bootloader_8c_source.html#l00145">bootloader_dfu_update_process()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00125">DFU_UPDATE_BOOT_COMPLETE</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00041">m_image_crc</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00093">dfu_start_packet_t::sd_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00137">dfu_update_status_t::sd_size</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00135">dfu_update_status_t::status_code</a>.</p>
<div class="fragment"><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;{</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> update_status;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a41de75b11fc5be19acc13404c22e9d90">status_code</a> = <a class="code" href="group__nrf__dfu__types.html#gga53842ec56bb0c14aa506551bfdc0c652abc485c0c24f01480b93a56a89aad0f1d">DFU_UPDATE_BOOT_COMPLETE</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a7be71576fc41a0e19af12014fb4b8e5e">app_crc</a>     = <a class="code" href="dfu__dual__bank__mod_8c.html#adfc241c56dd7f007af1567c3303351c7">m_image_crc</a>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a0b040f37b930d40a8541412c047ef4b6">sd_size</a>     = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#ac4532de3772b71ccfe7817006b0bb46d">bl_size</a>     = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#aaff20932440e5ee658dc80d50629755e">app_size</a>    = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef" title="Function for processing DFU status update. ">bootloader_dfu_update_process</a>(update_status);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac2956cfc015c2540bed09f59f8627f9c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_compare_block </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>ptr1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>ptr2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00663">663</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf__mbr_8h_source.html#l00124">sd_mbr_command_t::command</a>, <a class="el" href="nrf__mbr_8h_source.html#l00129">sd_mbr_command_t::compare</a>, <a class="el" href="nrf__mbr_8h_source.html#l00083">sd_mbr_command_compare_t::len</a>, <a class="el" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">sd_mbr_command_t::params</a>, <a class="el" href="nrf__mbr_8h_source.html#l00081">sd_mbr_command_compare_t::ptr1</a>, <a class="el" href="nrf__mbr_8h_source.html#l00082">sd_mbr_command_compare_t::ptr2</a>, and <a class="el" href="nrf__mbr_8h_source.html#l00047">SD_MBR_COMMAND_COMPARE</a>.</p>
<div class="fragment"><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;{</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <a class="code" href="structsd__mbr__command__t.html">sd_mbr_command_t</a> sd_mbr_cmd;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#af7e471411e95448316f756e3905fdcce">command</a>             = <a class="code" href="group___n_r_f___m_b_r___e_n_u_m_s.html#ggad416fbc71855eb8e1533a812164b85a7a5199987af2f952e4af19b1a30f02dbac">SD_MBR_COMMAND_COMPARE</a>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#adc2d5ab9f29898514d35676a5b79e954">ptr1</a> = ptr1;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#a047e907f08ea48e67173a1a784846d94">ptr2</a> = ptr2;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#a96bbf959016e4411c9e6b9812a8be60a">len</a>  = len / <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">return</span> sd_mbr_command(&amp;sd_mbr_cmd);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a69622e0a575a79baa350512c0ebd9bb7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_copy_sd </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00676">676</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf__mbr_8h_source.html#l00124">sd_mbr_command_t::command</a>, <a class="el" href="nrf__mbr_8h_source.html#l00127">sd_mbr_command_t::copy_sd</a>, <a class="el" href="nrf__mbr_8h_source.html#l00069">sd_mbr_command_copy_sd_t::dst</a>, <a class="el" href="nrf__mbr_8h_source.html#l00070">sd_mbr_command_copy_sd_t::len</a>, <a class="el" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">sd_mbr_command_t::params</a>, <a class="el" href="nrf__mbr_8h_source.html#l00045">SD_MBR_COMMAND_COPY_SD</a>, and <a class="el" href="nrf__mbr_8h_source.html#l00068">sd_mbr_command_copy_sd_t::src</a>.</p>
<div class="fragment"><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;{</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <a class="code" href="structsd__mbr__command__t.html">sd_mbr_command_t</a> sd_mbr_cmd;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#af7e471411e95448316f756e3905fdcce">command</a>            = <a class="code" href="group___n_r_f___m_b_r___e_n_u_m_s.html#ggad416fbc71855eb8e1533a812164b85a7a425aceb6eaa893f49011dada2c1dd812">SD_MBR_COMMAND_COPY_SD</a>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#a53fe8d3f36474ab6abf44e0a49a4a71d">copy_sd</a>.<a class="code" href="structsd__mbr__command__copy__sd__t.html#ada8a26a47f6ea51f0b7f7ab620e20e2f">src</a> = src;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#a53fe8d3f36474ab6abf44e0a49a4a71d">copy_sd</a>.<a class="code" href="structsd__mbr__command__copy__sd__t.html#a334025cc43089ee59d865feb6b23ab52">dst</a> = dst;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#a53fe8d3f36474ab6abf44e0a49a4a71d">copy_sd</a>.<a class="code" href="structsd__mbr__command__copy__sd__t.html#a96bbf959016e4411c9e6b9812a8be60a">len</a> = len / <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">return</span> sd_mbr_command(&amp;sd_mbr_cmd);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="add37ea8686866d90e3122acd659f6945"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t dfu_sd_img_block_swap </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>block_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00689">689</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00663">dfu_compare_block()</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00676">dfu_copy_sd()</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00054">SOFTDEVICE_REGION_START</a>.</p>
<div class="fragment"><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;{</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">// It is neccesarry to swap the new SoftDevice in 3 rounds to ensure correct copy of data</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">// and verifucation of data in case power reset occurs during write to flash. </span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="comment">// To ensure the robustness of swapping the images are compared backwards till start of</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">// image swap. If the back is identical everything is swapped.</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    uint32_t err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#ac2956cfc015c2540bed09f59f8627f9c">dfu_compare_block</a>(src, dst, len);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> (err_code == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">if</span> ((uint32_t)dst &gt; <a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a>)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#add37ea8686866d90e3122acd659f6945">dfu_sd_img_block_swap</a>((uint32_t *)((uint32_t)src - block_size), </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                                         (uint32_t *)((uint32_t)dst - block_size), </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                         block_size, </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                         block_size);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a69622e0a575a79baa350512c0ebd9bb7">dfu_copy_sd</a>(src, dst, len);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="dfu__dual__bank__mod_8c.html#ac2956cfc015c2540bed09f59f8627f9c">dfu_compare_block</a>(src, dst, len);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a3094a1e41850cba934bab311af4a1e0b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__dfu__bank__internal.html#ga187dfde3b0fa8047e6c97b2317bce21f">dfu_state_t</a> m_dfu_state</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Current DFU state. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00035">35</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab00a58089a8128240922402f85448953"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t m_image_size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Size of the image that will be transmitted. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00036">36</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac5439994e2f6fb1042537c1fed855c6a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdfu__start__packet__t.html">dfu_start_packet_t</a> m_start_packet</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Start packet received for this update procedure. Contains update mode and image sizes information to be used for image transfer. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00038">38</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1c48b18efe48b24a967f064ffe921e77"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t m_init_packet[64]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Init packet, can hold CRC, Hash, Signed Hash and similar, for image validation, integrety check and authorization checking. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00039">39</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3199edc3ad38b9ba7ff9db196f910b95"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t m_init_packet_length</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Length of init packet received. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00040">40</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="adfc241c56dd7f007af1567c3303351c7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t m_image_crc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Calculated CRC of the image received. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00041">41</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3fe6be7ea6e5f34a06da0e43ce6ff1a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__app__timer.html#gad024aa9066b1ca640dd171d83ee39290">app_timer_id_t</a> m_dfu_timer_id</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Application timer id. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00043">43</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad431bbfbae1cea8daed650e9b94f40e1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool m_dfu_timed_out = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Boolean flag value for tracking DFU timer timeout state. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00044">44</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a44f5af9763e456aea3551f638ffa0eac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pstorage_handle_t m_storage_handle_swap</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pstorage handle for the swap area (bank 1). Bank used when updating an application or bootloader without SoftDevice. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00046">46</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6b3f1c9689128450bf4003909457db43"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pstorage_handle_t m_storage_handle_app</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pstorage handle for the application area (bank 0). Bank used when updating a SoftDevice w/wo bootloader. Handle also used when swapping received application from bank 1 to bank 0. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00047">47</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0a21c12ec66e61f99824b0a24720494e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pstorage_handle_t* mp_storage_handle_active</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pointer to the pstorage handle for the active bank for receiving of data packets. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00048">48</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a01cb0b09fdb4844a87e99787e65eb3ca"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__nrf__dfu.html#gaacc31c43e887f7b9f1f462b39f5171c2">dfu_callback_t</a> m_data_pkt_cb</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Callback from DFU Bank module for notification of asynchronous operation such as flash prepare. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00050">50</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9501c0d8f1327a64b9a2bbf5a87bcdc3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdfu__bank__func__t.html">dfu_bank_func_t</a> m_functions</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Structure holding operations for the selected update process. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00051">51</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_753c3ab39a1e65d5d58171958880fde4.html">nrf51_beacon</a></li><li class="navelem"><a class="el" href="dir_7bb9c0916e75b1f4f3021293237d6d44.html">common</a></li><li class="navelem"><a class="el" href="dir_0495ca5c2b5ff72f9a00bb2e334f39be.html">sdk_modified</a></li><li class="navelem"><a class="el" href="dir_8b98ef680a73fa1d97d05c3bfd037996.html">dfu_dual_bank</a></li><li class="navelem"><a class="el" href="dfu__dual__bank__mod_8c.html">dfu_dual_bank_mod.c</a></li>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
