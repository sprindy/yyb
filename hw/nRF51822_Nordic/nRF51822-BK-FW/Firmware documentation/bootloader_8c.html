<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: components/libraries/bootloader_dfu/bootloader.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('bootloader_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bootloader.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="bootloader_8h_source.html">bootloader.h</a>&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="bootloader__types_8h_source.html">bootloader_types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bootloader__util_8h_source.html">bootloader_util.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bootloader__settings_8h_source.html">bootloader_settings.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dfu_8h_source.html">dfu.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dfu__transport_8h_source.html">dfu_transport.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf51_8h_source.html">nrf51.h</a>&quot;</code><br/>
<code>#include &quot;app_error.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf__sdm_8h_source.html">nrf_sdm.h</a>&quot;</code><br/>
<code>#include &quot;nordic_common.h&quot;</code><br/>
<code>#include &quot;crc16.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="pstorage_8h_source.html">pstorage.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app__scheduler_8h_source.html">app_scheduler.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="nrf__delay_8h_source.html">nrf_delay.h</a>&quot;</code><br/>
</div>
<p><a href="bootloader_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5fd51ee577ff4601ef894b97ebf8655f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#a5fd51ee577ff4601ef894b97ebf8655f">IRQ_ENABLED</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:a5fd51ee577ff4601ef894b97ebf8655f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad42398bd71179560441bbe063c3441cc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#ad42398bd71179560441bbe063c3441cc">MAX_NUMBER_INTERRUPTS</a>&#160;&#160;&#160;32</td></tr>
<tr class="separator:ad42398bd71179560441bbe063c3441cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a1c6647713c10a69e056a898bd5c048db"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048db">bootloader_status_t</a> { <br/>
&#160;&#160;<a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba1051648fd2df59acbd174f65330a2d11">BOOTLOADER_UPDATING</a>, 
<a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba4dca6c19999a1ab1e5034c7906c5567e">BOOTLOADER_SETTINGS_SAVING</a>, 
<a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba17071914a3cb77074e75fd053c646b36">BOOTLOADER_COMPLETE</a>, 
<a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dbac633cd0cca7091ce3c3d93493ef1154e">BOOTLOADER_TIMEOUT</a>, 
<br/>
&#160;&#160;<a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dbaae1912898cd791f81849be5ac47cf8d0">BOOTLOADER_RESET</a>
<br/>
 }</td></tr>
<tr class="memdesc:a1c6647713c10a69e056a898bd5c048db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumeration for specifying current bootloader status.  <a href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048db">More...</a><br/></td></tr>
<tr class="separator:a1c6647713c10a69e056a898bd5c048db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac06b13079d6ba8377eed0736c530a2d0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#ac06b13079d6ba8377eed0736c530a2d0">pstorage_callback_handler</a> (pstorage_handle_t *p_handle, uint8_t op_code, uint32_t result, uint8_t *p_data, uint32_t data_len)</td></tr>
<tr class="memdesc:ac06b13079d6ba8377eed0736c530a2d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling callbacks from pstorage module.  <a href="#ac06b13079d6ba8377eed0736c530a2d0">More...</a><br/></td></tr>
<tr class="separator:ac06b13079d6ba8377eed0736c530a2d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f93c1ca7c3b00b9deab2576f9059feb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#a1f93c1ca7c3b00b9deab2576f9059feb">wait_for_events</a> (void)</td></tr>
<tr class="memdesc:a1f93c1ca7c3b00b9deab2576f9059feb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for waiting for events.  <a href="#a1f93c1ca7c3b00b9deab2576f9059feb">More...</a><br/></td></tr>
<tr class="separator:a1f93c1ca7c3b00b9deab2576f9059feb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabd325fffda0cb29f1a8b917eb61d2494"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#gabd325fffda0cb29f1a8b917eb61d2494">bootloader_app_is_valid</a> (uint32_t app_addr)</td></tr>
<tr class="memdesc:gabd325fffda0cb29f1a8b917eb61d2494"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating application region in flash.  <a href="group__nrf__bootloader.html#gabd325fffda0cb29f1a8b917eb61d2494">More...</a><br/></td></tr>
<tr class="separator:gabd325fffda0cb29f1a8b917eb61d2494"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adde6e96499ef8509160ba87665ef268e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#adde6e96499ef8509160ba87665ef268e">bootloader_settings_save</a> (<a class="el" href="structbootloader__settings__t.html">bootloader_settings_t</a> *p_settings)</td></tr>
<tr class="separator:adde6e96499ef8509160ba87665ef268e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaebf46c5b600b9c2a5609c7f36954adef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef">bootloader_dfu_update_process</a> (<a class="el" href="structdfu__update__status__t.html">dfu_update_status_t</a> update_status)</td></tr>
<tr class="memdesc:gaebf46c5b600b9c2a5609c7f36954adef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for processing DFU status update.  <a href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef">More...</a><br/></td></tr>
<tr class="separator:gaebf46c5b600b9c2a5609c7f36954adef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa821efb3c4074cee13cb2a7377e793f1"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#gaa821efb3c4074cee13cb2a7377e793f1">bootloader_init</a> (void)</td></tr>
<tr class="memdesc:gaa821efb3c4074cee13cb2a7377e793f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the Bootloader.  <a href="group__nrf__bootloader.html#gaa821efb3c4074cee13cb2a7377e793f1">More...</a><br/></td></tr>
<tr class="separator:gaa821efb3c4074cee13cb2a7377e793f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf11a485218863db81385fe18437b5961"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#gaf11a485218863db81385fe18437b5961">bootloader_dfu_start</a> (void)</td></tr>
<tr class="memdesc:gaf11a485218863db81385fe18437b5961"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for starting the Device Firmware Update.  <a href="group__nrf__bootloader.html#gaf11a485218863db81385fe18437b5961">More...</a><br/></td></tr>
<tr class="separator:gaf11a485218863db81385fe18437b5961"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52680c4b8c82db2131e85783ea9cc2ea"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#a52680c4b8c82db2131e85783ea9cc2ea">interrupts_disable</a> (void)</td></tr>
<tr class="memdesc:a52680c4b8c82db2131e85783ea9cc2ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for disabling all interrupts before jumping from bootloader to application.  <a href="#a52680c4b8c82db2131e85783ea9cc2ea">More...</a><br/></td></tr>
<tr class="separator:a52680c4b8c82db2131e85783ea9cc2ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4fc5191d040a4abb9a23b52e22f56101"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#ga4fc5191d040a4abb9a23b52e22f56101">bootloader_app_start</a> (uint32_t app_addr)</td></tr>
<tr class="memdesc:ga4fc5191d040a4abb9a23b52e22f56101"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for exiting bootloader and booting into application.  <a href="group__nrf__bootloader.html#ga4fc5191d040a4abb9a23b52e22f56101">More...</a><br/></td></tr>
<tr class="separator:ga4fc5191d040a4abb9a23b52e22f56101"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga360affe1c4d4326b4daa465dee005330"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#ga360affe1c4d4326b4daa465dee005330">bootloader_dfu_sd_in_progress</a> (void)</td></tr>
<tr class="memdesc:ga360affe1c4d4326b4daa465dee005330"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function getting state of SoftDevice update in progress. After a successfull SoftDevice transfer the system restarts in orderto disable SoftDevice and complete the update.  <a href="group__nrf__bootloader.html#ga360affe1c4d4326b4daa465dee005330">More...</a><br/></td></tr>
<tr class="separator:ga360affe1c4d4326b4daa465dee005330"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2edc94128b91cbdc2551be36dc692ef0"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#ga2edc94128b91cbdc2551be36dc692ef0">bootloader_dfu_sd_update_continue</a> (void)</td></tr>
<tr class="memdesc:ga2edc94128b91cbdc2551be36dc692ef0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for continuing the Device Firmware Update of a SoftDevice.  <a href="group__nrf__bootloader.html#ga2edc94128b91cbdc2551be36dc692ef0">More...</a><br/></td></tr>
<tr class="separator:ga2edc94128b91cbdc2551be36dc692ef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga252165c548d698c2f001261314fecfce"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#ga252165c548d698c2f001261314fecfce">bootloader_dfu_sd_update_finalize</a> (void)</td></tr>
<tr class="memdesc:ga252165c548d698c2f001261314fecfce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for finalizing the Device Firmware Update of a SoftDevice.  <a href="group__nrf__bootloader.html#ga252165c548d698c2f001261314fecfce">More...</a><br/></td></tr>
<tr class="separator:ga252165c548d698c2f001261314fecfce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5a5868fa37d3f3ef4cdb3cd54cb81684"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__bootloader.html#ga5a5868fa37d3f3ef4cdb3cd54cb81684">bootloader_settings_get</a> (<a class="el" href="structbootloader__settings__t.html">bootloader_settings_t</a> *const p_settings)</td></tr>
<tr class="memdesc:ga5a5868fa37d3f3ef4cdb3cd54cb81684"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for retrieving the bootloader settings.  <a href="group__nrf__bootloader.html#ga5a5868fa37d3f3ef4cdb3cd54cb81684">More...</a><br/></td></tr>
<tr class="separator:ga5a5868fa37d3f3ef4cdb3cd54cb81684"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a92908d9404777ef46834dd00c44eab93"><td class="memItemLeft" align="right" valign="top">static pstorage_handle_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#a92908d9404777ef46834dd00c44eab93">m_bootsettings_handle</a></td></tr>
<tr class="separator:a92908d9404777ef46834dd00c44eab93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ef70c785a8c9304ef09305826dd6af7"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048db">bootloader_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bootloader_8c.html#a6ef70c785a8c9304ef09305826dd6af7">m_update_status</a></td></tr>
<tr class="separator:a6ef70c785a8c9304ef09305826dd6af7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a5fd51ee577ff4601ef894b97ebf8655f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IRQ_ENABLED&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Field identifying if an interrupt is enabled. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00029">29</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad42398bd71179560441bbe063c3441cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_NUMBER_INTERRUPTS&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of interrupts available. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00030">30</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a1c6647713c10a69e056a898bd5c048db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048db">bootloader_status_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enumeration for specifying current bootloader status. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="a1c6647713c10a69e056a898bd5c048dba1051648fd2df59acbd174f65330a2d11"></a>BOOTLOADER_UPDATING</em>&nbsp;</td><td class="fielddoc">
<p>Bootloader status for indicating that an update is in progress. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a1c6647713c10a69e056a898bd5c048dba4dca6c19999a1ab1e5034c7906c5567e"></a>BOOTLOADER_SETTINGS_SAVING</em>&nbsp;</td><td class="fielddoc">
<p>Bootloader status for indicating that saving of bootloader settings is in progress. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a1c6647713c10a69e056a898bd5c048dba17071914a3cb77074e75fd053c646b36"></a>BOOTLOADER_COMPLETE</em>&nbsp;</td><td class="fielddoc">
<p>Bootloader status for indicating that all operations for the update procedure has completed and it is safe to reset the system. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a1c6647713c10a69e056a898bd5c048dbac633cd0cca7091ce3c3d93493ef1154e"></a>BOOTLOADER_TIMEOUT</em>&nbsp;</td><td class="fielddoc">
<p>Bootloader status field for indicating that a timeout has occured and current update process should be aborted. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a1c6647713c10a69e056a898bd5c048dbaae1912898cd791f81849be5ac47cf8d0"></a>BOOTLOADER_RESET</em>&nbsp;</td><td class="fielddoc">
<p>Bootloader status field for indicating that a reset has been requested and current update process should be aborted. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00034">34</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba1051648fd2df59acbd174f65330a2d11">BOOTLOADER_UPDATING</a>,                                </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba4dca6c19999a1ab1e5034c7906c5567e">BOOTLOADER_SETTINGS_SAVING</a>,                         </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba17071914a3cb77074e75fd053c646b36">BOOTLOADER_COMPLETE</a>,                                </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dbac633cd0cca7091ce3c3d93493ef1154e">BOOTLOADER_TIMEOUT</a>,                                 </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dbaae1912898cd791f81849be5ac47cf8d0">BOOTLOADER_RESET</a>,                                   </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;} <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048db" title="Enumeration for specifying current bootloader status. ">bootloader_status_t</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac06b13079d6ba8377eed0736c530a2d0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pstorage_callback_handler </td>
          <td>(</td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>op_code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>data_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for handling callbacks from pstorage module. </p>
<p>Handles pstorage results for clear and storage operation. For detailed description of the parameters provided with the callback, please refer to <a class="el" href="group__pstorage__data__types.html#gaac1d429f24eb2850da6d8f8773a14c47">pstorage_ntf_cb_t</a>. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00051">51</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00038">BOOTLOADER_COMPLETE</a>, <a class="el" href="bootloader_8c_source.html#l00037">BOOTLOADER_SETTINGS_SAVING</a>, <a class="el" href="bootloader_8c_source.html#l00044">m_update_status</a>, and <a class="el" href="pstorage_8h_source.html#l00042">PSTORAGE_STORE_OP_CODE</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;{</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// If we are in BOOTLOADER_SETTINGS_SAVING state and we receive an PSTORAGE_STORE_OP_CODE</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// response then settings has been saved and update has completed.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="bootloader_8c.html#a6ef70c785a8c9304ef09305826dd6af7">m_update_status</a> == <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba4dca6c19999a1ab1e5034c7906c5567e">BOOTLOADER_SETTINGS_SAVING</a>) &amp;&amp; (op_code == <a class="code" href="group__ps__opcode.html#gad1415b8815fc4e0ba8f4f6bc2d8e3ce6">PSTORAGE_STORE_OP_CODE</a>))</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="bootloader_8c.html#a6ef70c785a8c9304ef09305826dd6af7">m_update_status</a> = <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba17071914a3cb77074e75fd053c646b36">BOOTLOADER_COMPLETE</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    APP_ERROR_CHECK(result);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1f93c1ca7c3b00b9deab2576f9059feb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void wait_for_events </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for waiting for events. </p>
<p>This function will place the chip in low power mode while waiting for events from the SoftDevice or other peripherals. When interrupted by an event, it will call the <a class="el" href="group__app__scheduler.html#gab725820c32a8d05379db4567cf30e862">app_sched_execute</a> function to process the received event. This function will return when the final state of the firmware update is reached OR when a tear down is in progress. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00076">76</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

<p>References <a class="el" href="app__scheduler_8c_source.html#l00168">app_sched_execute()</a>, <a class="el" href="bootloader_8c_source.html#l00038">BOOTLOADER_COMPLETE</a>, <a class="el" href="bootloader_8c_source.html#l00040">BOOTLOADER_RESET</a>, <a class="el" href="bootloader_8c_source.html#l00039">BOOTLOADER_TIMEOUT</a>, and <a class="el" href="bootloader_8c_source.html#l00044">m_update_status</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">for</span> (;;)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">// Wait in low power state for any events.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        uint32_t err_code = sd_app_evt_wait();</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">// Event received. Process it from the scheduler.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="group__app__scheduler.html#gab725820c32a8d05379db4567cf30e862" title="Function for executing all scheduled events. ">app_sched_execute</a>();</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="bootloader_8c.html#a6ef70c785a8c9304ef09305826dd6af7">m_update_status</a> == <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dba17071914a3cb77074e75fd053c646b36">BOOTLOADER_COMPLETE</a>) ||</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            (<a class="code" href="bootloader_8c.html#a6ef70c785a8c9304ef09305826dd6af7">m_update_status</a> == <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dbac633cd0cca7091ce3c3d93493ef1154e">BOOTLOADER_TIMEOUT</a>)  ||</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            (<a class="code" href="bootloader_8c.html#a6ef70c785a8c9304ef09305826dd6af7">m_update_status</a> == <a class="code" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048dbaae1912898cd791f81849be5ac47cf8d0">BOOTLOADER_RESET</a>))</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="comment">// When update has completed or a timeout/reset occured we will return.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adde6e96499ef8509160ba87665ef268e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void bootloader_settings_save </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbootloader__settings__t.html">bootloader_settings_t</a> *&#160;</td>
          <td class="paramname"><em>p_settings</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00132">132</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00043">m_bootsettings_handle</a>, <a class="el" href="pstorage__mod_8c_source.html#l01029">pstorage_clear()</a>, and <a class="el" href="pstorage__mod_8c_source.html#l00941">pstorage_store()</a>.</p>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;{</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    uint32_t err_code = <a class="code" href="group__pstorage__routines.html#ga64d9814f864c3f771a99eb7574e87dd0" title="Routine to clear data in persistent memory. ">pstorage_clear</a>(&amp;<a class="code" href="bootloader_8c.html#a92908d9404777ef46834dd00c44eab93">m_bootsettings_handle</a>, <span class="keyword">sizeof</span>(<a class="code" href="structbootloader__settings__t.html" title="Structure holding bootloader settings for application and bank data. ">bootloader_settings_t</a>));</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    err_code = <a class="code" href="group__pstorage__routines.html#ga12e52da12709de8d43bfb8389b80af6d" title="Routine to persistently store data of length &#39;size&#39; contained in &#39;p_src&#39; address in storage module at...">pstorage_store</a>(&amp;<a class="code" href="bootloader_8c.html#a92908d9404777ef46834dd00c44eab93">m_bootsettings_handle</a>,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                              (uint8_t *)p_settings,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                              <span class="keyword">sizeof</span>(<a class="code" href="structbootloader__settings__t.html" title="Structure holding bootloader settings for application and bank data. ">bootloader_settings_t</a>),</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                              0);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a52680c4b8c82db2131e85783ea9cc2ea"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void interrupts_disable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for disabling all interrupts before jumping from bootloader to application. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00289">289</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00029">IRQ_ENABLED</a>, and <a class="el" href="bootloader_8c_source.html#l00030">MAX_NUMBER_INTERRUPTS</a>.</p>
<div class="fragment"><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;{</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    uint32_t interrupt_setting_mask;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    uint32_t irq = 0; <span class="comment">// We start from first interrupt, i.e. interrupt 0.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// Fetch the current interrupt settings.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    interrupt_setting_mask = NVIC-&gt;ISER[0];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">for</span> (; irq &lt; <a class="code" href="bootloader_8c.html#ad42398bd71179560441bbe063c3441cc">MAX_NUMBER_INTERRUPTS</a>; irq++)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (interrupt_setting_mask &amp; (<a class="code" href="bootloader_8c.html#a5fd51ee577ff4601ef894b97ebf8655f">IRQ_ENABLED</a> &lt;&lt; irq))</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment">// The interrupt was enabled, and hence disable it.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            NVIC_DisableIRQ((<a class="code" href="group__n_r_f51.html#ga7e1129cd8a196f4284d41db3e82ad5c8">IRQn_Type</a>)irq);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a92908d9404777ef46834dd00c44eab93"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pstorage_handle_t m_bootsettings_handle</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pstorage handle to use for registration and identifying the bootloader module on subsequent calls to the pstorage module for load and store of bootloader setting in flash. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00043">43</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6ef70c785a8c9304ef09305826dd6af7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="bootloader_8c.html#a1c6647713c10a69e056a898bd5c048db">bootloader_status_t</a> m_update_status</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Current update status for the bootloader module to ensure correct behaviour when updating settings and when update completes. </p>

<p>Definition at line <a class="el" href="bootloader_8c_source.html#l00044">44</a> of file <a class="el" href="bootloader_8c_source.html">bootloader.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_91b59e8f2130a1dd874d9e7c771a276d.html">components</a></li><li class="navelem"><a class="el" href="dir_cba6476b77d20c46e2df1d037244e991.html">libraries</a></li><li class="navelem"><a class="el" href="dir_d43a1a39d1eb8b384089a92cd78d95d5.html">bootloader_dfu</a></li><li class="navelem"><a class="el" href="bootloader_8c.html">bootloader.c</a></li>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:10 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
