<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: System Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nrfr_overview_page.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">System Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="overview_page"></a></p>
<p>A beacon advertises location specific data and can provide basic navigation through <em>Bluetooth&reg;</em> Low Energy nodes. The nodes advertise a limited amount of data to let other devices, such as a phone or a tablet, know that they exist and approximately how far away they are. The beacons are using the "Manufacturer Specific Data" field in the advertising packet to include a unique 128-bit UUID to identify companies or unique entities, as well as two 16-bit values (called 'Major' and 'Minor') that allow you to differentiate specific stores/premises (Major) and individual beacon nodes (Minor).</p>
<p>The beacons operate in four different levels of proximity and may trigger behavior based on those: </p>
<table class="doxtable">
<caption align="bottom">Proximity ranges</caption>
<tr align="center">
<th>Level </th><th>Proximity </th></tr>
<tr align="center">
<td>At beacon </td><td>Device is touching the beacon </td></tr>
<tr align="center">
<td>Near </td><td>Close proximity. 1-2 meter </td></tr>
<tr align="center">
<td>In range </td><td>More than 2 meters, but still in range of the beacon </td></tr>
<tr align="center">
<td>Out of range </td><td>You are leaving the range of the beacon </td></tr>
</table>
<p>The beacons have three different modes of operation:</p>
<ul>
<li><b>Normal beacon mode</b>: Normal beacon mode advertises the beacon package at a regular interval specified in the code (default is 760 ms).</li>
<li><b>Beacon configuration mode</b>: Beacon configuration mode lets the user configure each beacon by connecting over <em>Bluetooth&reg;</em> Low Energy.</li>
<li><b>DFU mode</b>: DFU mode ensures that it's possible to do firmware upgrades over <em>Bluetooth&reg;</em> Low Energy without connecting a debug interface to the HW.</li>
</ul>
<h1><a class="anchor" id="overview_page_normal"></a>
Normal beacon mode</h1>
<p>Normal beacon mode is indicated by purple softblinks on the beacon and is the default mode upon power on. In this mode the beacon will advertise as not connectable and use the "Manufacturer Specific Data" field to send the beacon specific data. Inside the "Manufacturer Specific Data" field in the advertising packet, you will find the following data: </p>
<table class="doxtable">
<caption align="bottom">Manufacturer Specific Data</caption>
<tr align="center">
<th>Field </th><th>Bytes </th><th>Description </th></tr>
<tr align="center">
<td>Company ID </td><td>2 </td><td>Company identifier from Bluetooth SIG. </td></tr>
<tr align="center">
<td>ID </td><td>1 </td><td>This will always be 0x02 and represents a beacon. </td></tr>
<tr align="center">
<td>Data Length </td><td>1 </td><td>The number of bytes in the rest of the payload. </td></tr>
<tr align="center">
<td>UUID </td><td>16 </td><td>The 128-bit ID identifying your company/store/etc. </td></tr>
<tr align="center">
<td>Major </td><td>2 </td><td>The major value (to differentiate individual stores, etc.) </td></tr>
<tr align="center">
<td>Minor </td><td>2 </td><td>The minor value (to differentiate nodes with one location, etc.) </td></tr>
<tr align="center">
<td>TX Power </td><td>1 </td><td><p class="starttd">Represents the RSSI value for the beacon at a distance of 1 meter.</p>
<p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="overview_page_config"></a>
Beacon configuration mode</h1>
<p>To enter the beacon configuration mode press the "configuration mode button" and observe that the light starts to softblink yellow on the beacon. Now the beacon has started advertising as connectable and it's possible to connect and configure UUID, major, minor, the measured RSSI value at 1 meter, company identifier, advertising interval and LED softblink on or off in normal beacon mode.</p>
<p><b>Configuration</b></p>
<ol type="1">
<li>Open Master Control Panel.</li>
<li>Press the "configuration mode button" on the beacon HW.</li>
<li>Click <b>Discover services</b>.</li>
<li>Select the <b>Beacon Config</b> device in Master Control Panel.</li>
<li>Click <b>Select device</b>. <div class="image">
<img src="mcp_config_mode.png" alt="mcp_config_mode.png"/>
<div class="caption">
Finding device</div></div>
</li>
<li>Click on <b>Service discovery</b> and observe that the service and characteristics are read.<br/>
</li>
<li>Click on the configuration characteristic UUID <b>0x1526</b> to configure major/minor.<br/>
 7.1. Enter the prefered major and minor values in the input field (major is the two first bytes and minor is the two last) and click <b>Write</b>.<br/>
</li>
<li>Click on the configuration characteristic UUID <b>0x1525</b> to configure measured RSSI at one meter.<br/>
 8.1. Enter the measured RSSI in the input field (signed 8-bit integer) and click <b>Write</b>. <br/>
</li>
<li>Click on the configuration characteristic UUID <b>0x1524</b> to configure beacon UUID.<br/>
 9.1. Enter the new beacon UUID in the input field (default is 01-12-23-34-45-56-67-78-89-9A-AB-BC-CD-DE-EF-F0) and click <b>Write</b>.<br/>
</li>
<li>Click on the configuration characteristic UUID <b>0x1527</b> to configure company identifier.<br/>
 10.1. Enter the company identifier in the input field (unsigned 16-bits integer) and click <b>Write</b>. <br/>
</li>
<li>Click on the configuration characteristic UUID <b>0x1528</b> to configure advertising interval.<br/>
 11.1. Enter the advertising interval in the input field (unsigned 16-bits integer) and click <b>Write</b>. <br/>
</li>
<li>Click on the configuration characteristic UUID <b>0x1529</b> to configure the LED on or off.<br/>
 12.1. Enter the wanted LED value in the input field (unsigned 8-bits integer, 00 is off and 01 is on) and click <b>Write</b>. <br/>
</li>
<li>Click on <b>Disconnect</b> to leave configuration mode and enter normal beacon mode. The LED should now softblink purple if it's configured to on.<br/>
 <div class="image">
<img src="mcp_config_mode_2.png" alt="mcp_config_mode_2.png"/>
<div class="caption">
Configuring device</div></div>
 </li>
</ol>
<h1><a class="anchor" id="overview_page_dfu"></a>
Over the air Device Firmware Upgrade</h1>
<p>Device firmware upgrade mode allows you to flash a new application, bootloader or softdevice HEX to the device. This mode is entered by pressing the DFU mode button on the hardware and the LED will start to softblink blue on the beacon.</p>
<p>To flash a new FW HEX file in DFU mode, either follow the last steps of the <a class="el" href="nrfr_programming_page.html#programming_page_dfu">Firmware upgrade procedure</a> (step 11 - 17) and use Master Control Panel, follow the <b>nrf51_beacon\ble_app_beacon_dfu\ble_dfu_send_hex\readme.txt</b> and use IronPython and Master Emulator or use the Android/iOS beacon app to flash new FW.</p>
<dl class="section note"><dt>Note</dt><dd>Master Control Panel, Version 3.7.1 and earlier does not support DFU init_packet_handling out of the box, but can be modified to do so. See <a class="el" href="nrfr_programming_page.html#dfu_bootloader_dfu_script_subsec">Master Control Panel, v.3.7.1</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
