<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: DFU transport API.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__nrf__dfu__transport.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">DFU transport API.</div>  </div>
</div><!--header-->
<div class="contents">

<p>DFU transport module interface.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaea872c4e8b0fc157a5ca968b683eb591"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu__transport.html#gaea872c4e8b0fc157a5ca968b683eb591">dfu_transport_update_start</a> (void)</td></tr>
<tr class="memdesc:gaea872c4e8b0fc157a5ca968b683eb591"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for starting the update of Device Firmware.  <a href="#gaea872c4e8b0fc157a5ca968b683eb591">More...</a><br/></td></tr>
<tr class="separator:gaea872c4e8b0fc157a5ca968b683eb591"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga04a691c0efff2215cf82d3b797d7dcd2"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu__transport.html#ga04a691c0efff2215cf82d3b797d7dcd2">dfu_transport_close</a> (void)</td></tr>
<tr class="memdesc:ga04a691c0efff2215cf82d3b797d7dcd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for closing the transport layer.  <a href="#ga04a691c0efff2215cf82d3b797d7dcd2">More...</a><br/></td></tr>
<tr class="separator:ga04a691c0efff2215cf82d3b797d7dcd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>DFU transport module interface. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaea872c4e8b0fc157a5ca968b683eb591"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_transport_update_start </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for starting the update of Device Firmware. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>Operation success. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu__transport__ble__mod_8c_source.html#l00867">867</a> of file <a class="el" href="dfu__transport__ble__mod_8c_source.html">dfu_transport_ble_mod.c</a>.</p>

<p>References <a class="el" href="dfu__transport__ble_8c_source.html#l00614">advertising_start()</a>, <a class="el" href="dfu__transport__serial_8c_source.html#l00024">APP_GPIOTE_MAX_USERS</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00792">ble_evt_dispatch()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00467">conn_params_init()</a>, <a class="el" href="dfu__transport__serial_8c_source.html#l00087">data_queue_init()</a>, <a class="el" href="dfu__ble__svc_8c_source.html#l00122">dfu_ble_get_peer_data()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00156">dfu_cb_handler()</a>, <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00339">dfu_register_callback()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00818">gap_params_init()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00804">leds_init()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00102">m_ble_peer_data_valid</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00091">m_pkt_type</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="dfu__transport__ble__mod_8c_source.html#l00080">PKT_TYPE_INVALID</a>, <a class="el" href="dfu__transport__serial_8c_source.html#l00249">rpc_transport_event_handler()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00878">sec_params_init()</a>, and <a class="el" href="dfu__transport__ble_8c_source.html#l00858">services_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;{</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <a class="code" href="dfu__transport__ble__mod_8c.html#a92fc35c090288f082893b5ab89dd936d">m_pkt_type</a> = <a class="code" href="dfu__transport__ble__mod_8c.html#a728d7e4765a1b65d224baf47c2c17e82a46a10d7a58f07b6d1b08d52dfeb09bd4">PKT_TYPE_INVALID</a>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    err_code = softdevice_ble_evt_handler_set(<a class="code" href="dfu__transport__ble__mod_8c.html#a2b08d6ccb6e7f4588d2ac843d4494c0e" title="Function for dispatching a S110 SoftDevice event to all modules with a S110 SoftDevice event handler...">ble_evt_dispatch</a>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="group__nrf__dfu.html#gac459a6787392cac2da15bc87ce7b99c9" title="Function for registering a callback listener for dfu_data_pkt_handle callbacks. ">dfu_register_callback</a>(<a class="code" href="dfu__transport__ble__mod_8c.html#aaaf75f3e9774a13d03d926100189c9c5" title="Function for handling the callback events from the dfu module. Callbacks are expected when dfu_data_p...">dfu_cb_handler</a>);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    err_code = hci_mem_pool_open();</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    err_code = <a class="code" href="group__nrf__dfu__ble__svc__internal.html#gaae1ae9e244a40aeee3537eeb9e7d455e" title="Internal bootloader/DFU function for retrieving peer data provided from application. ">dfu_ble_get_peer_data</a>(&amp;<a class="code" href="dfu__transport__ble__mod_8c.html#a91a725bbca0089501cc26f154ec1c18a">m_ble_peer_data</a>);</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">if</span> (err_code == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <a class="code" href="dfu__transport__ble__mod_8c.html#acccc76b80e06802fb8c169ce646c5c91">m_ble_peer_data_valid</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <a class="code" href="dfu__transport__ble__mod_8c.html#a1004973353f351806e42896c491a5ab2" title="Function for the GAP initialization. ">gap_params_init</a>();</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <a class="code" href="dfu__transport__ble__mod_8c.html#a5b27b40e18af00d43b92f57eaed0e9b2" title="Function for initializing services that will be used by the application. ">services_init</a>();</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <a class="code" href="dfu__transport__ble__mod_8c.html#af61b6c1c47f5c96b169ff81c345d7849" title="Function for initializing the Connection Parameters module. ">conn_params_init</a>();</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="dfu__transport__ble__mod_8c.html#a9f11118fb9ce22ad1afe20af6f89b131" title="Function for initializing security parameters. ">sec_params_init</a>();</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="dfu__transport__ble__mod_8c.html#adf80cd84ee702e57a2a416fe4f653eb8" title="Function for starting advertising. ">advertising_start</a>();</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga04a691c0efff2215cf82d3b797d7dcd2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_transport_close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for closing the transport layer. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>Operation success. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu__transport__ble__mod_8c_source.html#l00903">903</a> of file <a class="el" href="dfu__transport__ble__mod_8c_source.html">dfu_transport_ble_mod.c</a>.</p>

<p>References <a class="el" href="dfu__transport__ble_8c_source.html#l00679">advertising_stop()</a>, <a class="el" href="ble__conn__params_8c_source.html#l00135">ble_conn_params_stop()</a>, <a class="el" href="ble__hci_8h_source.html#l00040">BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION</a>, <a class="el" href="dfu__transport__serial_8c_source.html#l00169">data_queue_flush()</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00076">IS_CONNECTED</a>, <a class="el" href="dfu__transport__ble_8c_source.html#l00099">m_conn_handle</a>, and <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>.</p>
<div class="fragment"><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;{</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dfu__transport__ble__mod_8c.html#a0ad0d988811ac1a3222bf78f99777690">IS_CONNECTED</a>())</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">// Disconnect from peer.</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        err_code = sd_ble_gap_disconnect(<a class="code" href="dfu__transport__ble__mod_8c.html#a07ee43d70915ea4e112b7d303258840d">m_conn_handle</a>, <a class="code" href="group___b_l_e___h_c_i___s_t_a_t_u_s___c_o_d_e_s.html#gad4caeb4bcc901a4f1b00068c498a090c">BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION</a>);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="comment">// If not connected, then the device will be advertising. Hence stop the advertising.</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <a class="code" href="dfu__transport__ble__mod_8c.html#a09bc2c1b7fd392c9ba69130ce68dda0d" title="Function for stopping advertising. ">advertising_stop</a>();</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    err_code = <a class="code" href="group__ble__sdk__lib__conn__params.html#ga5f6590546ae62fdfc802236be684428f" title="Function for stopping the Connection Parameters module. ">ble_conn_params_stop</a>();</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
