<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: Persistent Storage Access Routines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__pstorage__routines.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Persistent Storage Access Routines<div class="ingroups"><a class="el" href="group__persistent__storage.html">Persistent Storage Interface</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions/Interface SDK modules use to persistently store data.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga729ef8b64fc0cb6bfdabb2543a565d32"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga729ef8b64fc0cb6bfdabb2543a565d32">pstorage_init</a> (void)</td></tr>
<tr class="memdesc:ga729ef8b64fc0cb6bfdabb2543a565d32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Module Initialization Routine.  <a href="#ga729ef8b64fc0cb6bfdabb2543a565d32">More...</a><br/></td></tr>
<tr class="separator:ga729ef8b64fc0cb6bfdabb2543a565d32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a57b964c8945eaca2d267835ef6688c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga0a57b964c8945eaca2d267835ef6688c">pstorage_register</a> (<a class="el" href="structpstorage__module__param__t.html">pstorage_module_param_t</a> *p_module_param, pstorage_handle_t *p_block_id)</td></tr>
<tr class="memdesc:ga0a57b964c8945eaca2d267835ef6688c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register with persistent storage interface.  <a href="#ga0a57b964c8945eaca2d267835ef6688c">More...</a><br/></td></tr>
<tr class="separator:ga0a57b964c8945eaca2d267835ef6688c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafdeeb475e4f2db19863226bc55d507b5"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#gafdeeb475e4f2db19863226bc55d507b5">pstorage_block_identifier_get</a> (pstorage_handle_t *p_base_id, pstorage_size_t block_num, pstorage_handle_t *p_block_id)</td></tr>
<tr class="memdesc:gafdeeb475e4f2db19863226bc55d507b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to get block id with reference to base block identifier provided at time of registration.  <a href="#gafdeeb475e4f2db19863226bc55d507b5">More...</a><br/></td></tr>
<tr class="separator:gafdeeb475e4f2db19863226bc55d507b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga12e52da12709de8d43bfb8389b80af6d"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga12e52da12709de8d43bfb8389b80af6d">pstorage_store</a> (pstorage_handle_t *p_dest, uint8_t *p_src, pstorage_size_t size, pstorage_size_t offset)</td></tr>
<tr class="memdesc:ga12e52da12709de8d43bfb8389b80af6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routine to persistently store data of length 'size' contained in 'p_src' address in storage module at 'p_dest' address; Equivalent to Storage Write.  <a href="#ga12e52da12709de8d43bfb8389b80af6d">More...</a><br/></td></tr>
<tr class="separator:ga12e52da12709de8d43bfb8389b80af6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0316f640da7481e9bd03ed51b29a3e65"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga0316f640da7481e9bd03ed51b29a3e65">pstorage_update</a> (pstorage_handle_t *p_dest, uint8_t *p_src, pstorage_size_t size, pstorage_size_t offset)</td></tr>
<tr class="memdesc:ga0316f640da7481e9bd03ed51b29a3e65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routine to update persistently stored data of length 'size' contained in 'p_src' address in storage module at 'p_dest' address.  <a href="#ga0316f640da7481e9bd03ed51b29a3e65">More...</a><br/></td></tr>
<tr class="separator:ga0316f640da7481e9bd03ed51b29a3e65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga99402440650cc2d2ee63d8866760a25b"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga99402440650cc2d2ee63d8866760a25b">pstorage_load</a> (uint8_t *p_dest, pstorage_handle_t *p_src, pstorage_size_t size, pstorage_size_t offset)</td></tr>
<tr class="memdesc:ga99402440650cc2d2ee63d8866760a25b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routine to load persistently stored data of length 'size' from 'p_src' address to 'p_dest' address; Equivalent to Storage Read.  <a href="#ga99402440650cc2d2ee63d8866760a25b">More...</a><br/></td></tr>
<tr class="separator:ga99402440650cc2d2ee63d8866760a25b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga64d9814f864c3f771a99eb7574e87dd0"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga64d9814f864c3f771a99eb7574e87dd0">pstorage_clear</a> (pstorage_handle_t *p_base_id, pstorage_size_t size)</td></tr>
<tr class="memdesc:ga64d9814f864c3f771a99eb7574e87dd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routine to clear data in persistent memory.  <a href="#ga64d9814f864c3f771a99eb7574e87dd0">More...</a><br/></td></tr>
<tr class="separator:ga64d9814f864c3f771a99eb7574e87dd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1553a4d6d6d8ddf070d0eb4960b72d62"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pstorage__routines.html#ga1553a4d6d6d8ddf070d0eb4960b72d62">pstorage_access_status_get</a> (uint32_t *p_count)</td></tr>
<tr class="memdesc:ga1553a4d6d6d8ddf070d0eb4960b72d62"><td class="mdescLeft">&#160;</td><td class="mdescRight">API to get status of number of pending operations with the module.  <a href="#ga1553a4d6d6d8ddf070d0eb4960b72d62">More...</a><br/></td></tr>
<tr class="separator:ga1553a4d6d6d8ddf070d0eb4960b72d62"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions/Interface SDK modules use to persistently store data. </p>
<p>Interface for Application &amp; SDK module to load/store information persistently. Note: that while implementation of each of the persistent storage access function depends on the system and can specific to system/solution, the signature of the interface routines should not be altered. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga729ef8b64fc0cb6bfdabb2543a565d32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Module Initialization Routine. </p>
<p>Initializes module. To be called once before any other APIs of the module are used.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l00821">821</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__mod_8c_source.html#l00167">pstorage_module_table_t::block_count</a>, <a class="el" href="pstorage__mod_8c_source.html#l00166">pstorage_module_table_t::block_size</a>, <a class="el" href="pstorage__mod_8c_source.html#l00164">pstorage_module_table_t::cb</a>, <a class="el" href="pstorage_8c_source.html#l00282">cmd_queue_init()</a>, <a class="el" href="pstorage__mod_8c_source.html#l00215">cmd_queue_t::flash_access</a>, <a class="el" href="pstorage_8c_source.html#l00224">m_module_initialized</a>, <a class="el" href="pstorage_8c_source.html#l00221">m_next_app_instance</a>, <a class="el" href="pstorage_8c_source.html#l00222">m_next_page_addr</a>, <a class="el" href="pstorage_8c_source.html#l00223">m_round_val</a>, <a class="el" href="pstorage_8c_source.html#l00225">m_swap_state</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage__mod_8c_source.html#l00168">pstorage_module_table_t::num_of_pages</a>, <a class="el" href="pstorage__mod_8c_source.html#l00144">STATE_INIT</a>, and <a class="el" href="pstorage__mod_8c_source.html#l00152">STATE_SWAP_DIRTY</a>.</p>
<div class="fragment"><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;{</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    uint32_t retval;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="group__utility__functions.html#gade390fede7a3eff9869a7850a6b53c02" title="Initializes command queue. ">cmd_queue_init</a>();</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a> = 0;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a2d3292c0e300f3deb4b05d9fe6354779">m_next_page_addr</a>    = PSTORAGE_DATA_START_ADDR;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="code" href="pstorage__mod_8c.html#afa78b6a4bd7867f97c12b4ff45e9db22">m_round_val</a>         = 0;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">for</span> (uint32_t index = 0; index &lt; PSTORAGE_MAX_APPLICATIONS; index++)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[index].<a class="code" href="structpstorage__module__table__t.html#ab8f4b0c725d674a9bea99f4dea529a4d">cb</a>           = NULL;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[index].<a class="code" href="structpstorage__module__table__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a>   = 0;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[index].<a class="code" href="structpstorage__module__table__t.html#a8b66153406c7d35f7039864a74e15d6f">num_of_pages</a> = 0;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[index].<a class="code" href="structpstorage__module__table__t.html#a61b52fca7b9d21e4e92565386bd38dc4">block_count</a>  = 0;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="preprocessor">#ifdef PSTORAGE_RAW_MODE_ENABLE</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="preprocessor"></span>    m_raw_app_table.cb           = NULL;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    m_raw_app_table.num_of_pages = 0;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a7e99e7d02e854ee64a37440c60bf641e">m_module_initialized</a>         = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a424c25c247944aad095274cfd4429646">m_swap_state</a>                 = <a class="code" href="pstorage__mod_8c.html#a69fa0c3173bb59cc6a4907cb18de03eca98d2a2153b4ae0445fa0b114d65b94d9">STATE_INIT</a>;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    retval = <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor"></span>    <a class="code" href="pstorage__mod_8c.html#a424c25c247944aad095274cfd4429646">m_swap_state</a> = <a class="code" href="pstorage__mod_8c.html#a69fa0c3173bb59cc6a4907cb18de03eca2f95a4ddba06ae64a00fcb3178a8114f">STATE_SWAP_DIRTY</a>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">// Erase swap region in case it is dirty.</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    retval = sd_flash_page_erase(PSTORAGE_SWAP_ADDR / PSTORAGE_FLASH_PAGE_SIZE);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">if</span> (retval == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="pstorage__mod_8c.html#aa4316c8dd50f357ae5f6b4d5c8c2e85a">m_cmd_queue</a>.<a class="code" href="structcmd__queue__t.html#a18edda1bb75cef5bb6ecd979b970b9f4">flash_access</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <a class="code" href="pstorage__mod_8c.html#a7e99e7d02e854ee64a37440c60bf641e">m_module_initialized</a>     = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor">#endif //PSTORAGE_RAW_MODE_ENABLE</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga0a57b964c8945eaca2d267835ef6688c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_register </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpstorage__module__param__t.html">pstorage_module_param_t</a> *&#160;</td>
          <td class="paramname"><em>p_module_param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_block_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register with persistent storage interface. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_module_param</td><td>Module registration param. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">p_block_id</td><td>Block identifier to identify persistent memory blocks in case registration succeeds. Application is expected to use the block ids for subsequent operations on requested persistent memory. Maximum registrations permitted is determined by configuration parameter PSTORAGE_MAX_APPLICATIONS. In case more than one memory blocks are requested, the identifier provided here is the base identifier for the first block and to identify subsequent block, application shall use @ref pstorage_block_identifier_get with this base identifier and block number. Therefore if 10 blocks of size 64 are requested and application wishes to store memory in 6th block, it shall use @ref pstorage_block_identifier_get with based id and provide a block number of 5. This way application is only expected to remember the base block identifier.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>To register an area with a total size (block count * block size) larger than the page size (usually 1024 bytes), the block size must be a divisor of the page size (page size % block size == 0).</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_PARAM</td><td>if invalid parameters are passed to the API. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NO_MEM</td><td>in case no more registrations can be supported. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l00862">862</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__mod_8c_source.html#l00165">pstorage_module_table_t::base_id</a>, <a class="el" href="pstorage_8h_source.html#l00092">pstorage_module_param_t::block_count</a>, <a class="el" href="pstorage__mod_8c_source.html#l00167">pstorage_module_table_t::block_count</a>, <a class="el" href="pstorage_8c_source.html#l00080">BLOCK_COUNT_CHECK</a>, <a class="el" href="pstorage_8h_source.html#l00086">pstorage_module_param_t::block_size</a>, <a class="el" href="pstorage__mod_8c_source.html#l00166">pstorage_module_table_t::block_size</a>, <a class="el" href="pstorage_8c_source.html#l00071">BLOCK_SIZE_CHECK</a>, <a class="el" href="pstorage_8h_source.html#l00085">pstorage_module_param_t::cb</a>, <a class="el" href="pstorage__mod_8c_source.html#l00164">pstorage_module_table_t::cb</a>, <a class="el" href="pstorage_8c_source.html#l00221">m_next_app_instance</a>, <a class="el" href="pstorage_8c_source.html#l00222">m_next_page_addr</a>, <a class="el" href="pstorage__nosd_8c_source.html#l00106">MODULE_SIZE_CHECK</a>, <a class="el" href="nrf__error_8h_source.html#l00035">NRF_ERROR_INVALID_PARAM</a>, <a class="el" href="nrf__error_8h_source.html#l00032">NRF_ERROR_NO_MEM</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, <a class="el" href="pstorage__mod_8c_source.html#l00168">pstorage_module_table_t::num_of_pages</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;{</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    uint16_t page_count;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    uint32_t total_size;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_module_param);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_block_id);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#ab8f4b0c725d674a9bea99f4dea529a4d">cb</a>);</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="group__api__param__check.html#ga390c0edec329da58f574fd36b99fbcd6" title="Verifies the block size requested by the application can be supported by the module. ">BLOCK_SIZE_CHECK</a>(p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a>);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="group__api__param__check.html#ga5e14b8accad4619d2ae281ddeea57b81" title="Verifies block size requested by Application in registration API. ">BLOCK_COUNT_CHECK</a>(p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#a61b52fca7b9d21e4e92565386bd38dc4">block_count</a>, p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// Block size should be a multiple of word size.</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span> (!((p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a> % <span class="keyword">sizeof</span>(uint32_t)) == 0))</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga0a5831cf5092e0dd43a01869676ee076" title="Invalid Parameter. ">NRF_ERROR_INVALID_PARAM</a>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a> == PSTORAGE_MAX_APPLICATIONS)</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7ef4d466b79b31c6325f8b7af5d4f75f" title="No Memory for operation. ">NRF_ERROR_NO_MEM</a>;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    p_block_id-&gt;module_id = <a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    p_block_id-&gt;block_id  = <a class="code" href="pstorage__mod_8c.html#a2d3292c0e300f3deb4b05d9fe6354779">m_next_page_addr</a>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[<a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>].<a class="code" href="structpstorage__module__table__t.html#a145ebf201bffca896638196635538b3c">base_id</a>     = p_block_id-&gt;block_id;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[<a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>].<a class="code" href="structpstorage__module__table__t.html#ab8f4b0c725d674a9bea99f4dea529a4d">cb</a>          = p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#ab8f4b0c725d674a9bea99f4dea529a4d">cb</a>;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[<a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>].<a class="code" href="structpstorage__module__table__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a>  = p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[<a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>].<a class="code" href="structpstorage__module__table__t.html#a61b52fca7b9d21e4e92565386bd38dc4">block_count</a> = p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#a61b52fca7b9d21e4e92565386bd38dc4">block_count</a>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="comment">// Calculate number of flash pages allocated for the device.</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    page_count = 0;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    total_size = p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a> * p_module_param-&gt;<a class="code" href="structpstorage__module__param__t.html#a61b52fca7b9d21e4e92565386bd38dc4">block_count</a>;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">do</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        page_count++;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="keywordflow">if</span> (total_size &gt; PSTORAGE_FLASH_PAGE_SIZE)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            total_size -= PSTORAGE_FLASH_PAGE_SIZE;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            total_size = 0;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <a class="code" href="pstorage__mod_8c.html#a2d3292c0e300f3deb4b05d9fe6354779">m_next_page_addr</a> += PSTORAGE_FLASH_PAGE_SIZE;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">while</span> (total_size &gt;= PSTORAGE_FLASH_PAGE_SIZE);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[<a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>].<a class="code" href="structpstorage__module__table__t.html#a8b66153406c7d35f7039864a74e15d6f">num_of_pages</a> = page_count;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <a class="code" href="pstorage__mod_8c.html#aeb0ea5d8898efee3644c43b2206d4a57">m_next_app_instance</a>++;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gafdeeb475e4f2db19863226bc55d507b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_block_identifier_get </td>
          <td>(</td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_base_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>block_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_block_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to get block id with reference to base block identifier provided at time of registration. </p>
<p>Function to get block id with reference to base block identifier provided at time of registration. In case more than one memory blocks were requested when registering, the identifier provided here is the base identifier for the first block and to identify subsequent block, application shall use this routine to get block identifier providing input as base identifier and block number. Therefore if 10 blocks of size 64 are requested and application wishes to store memory in 6th block, it shall use @ref pstorage_block_identifier_get with based id and provide a block number of 5. This way application is only expected to remember the base block identifier.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_base_id</td><td>Base block id received at the time of registration. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block_num</td><td>Block Number, with first block numbered zero. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">p_block_id</td><td>Block identifier for the block number requested in case the API succeeds.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_PARAM</td><td>if invalid parameters are passed to the API. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l00919">919</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage_8c_source.html#l00061">BLOCK_ID_RANGE_CHECK</a>, <a class="el" href="pstorage_8c_source.html#l00138">MODULE_BLOCK_SIZE</a>, <a class="el" href="pstorage_8c_source.html#l00050">MODULE_ID_RANGE_CHECK</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;{</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    pstorage_handle_t temp_id;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_base_id);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_block_id);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <a class="code" href="group__api__param__check.html#gaae9da1fe8e7ab5ff48f1bfec1a3e021a" title="Verifies the module identifier supplied by the application is within permissible range. ">MODULE_ID_RANGE_CHECK</a>(p_base_id);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    temp_id           = (*p_base_id);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    temp_id.block_id += (block_num * <a class="code" href="pstorage__mod_8c.html#acd01180037c08795d18b60f42068b4d9" title="Macro to fetch the block size registered for the module. ">MODULE_BLOCK_SIZE</a>(p_base_id));</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <a class="code" href="group__api__param__check.html#gac113d37e10e428c70c18b974d0e1aba6" title="Verifies the block identifier supplied by the application is within the permissible range...">BLOCK_ID_RANGE_CHECK</a>(&amp;temp_id);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    (*p_block_id) = temp_id;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga12e52da12709de8d43bfb8389b80af6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_store </td>
          <td>(</td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Routine to persistently store data of length 'size' contained in 'p_src' address in storage module at 'p_dest' address; Equivalent to Storage Write. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_dest</td><td>Destination address where data is to be stored persistently. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_src</td><td>Source address containing data to be stored. API assumes this to be resident memory and no intermediate copy of data is made by the API. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of data to be stored expressed in bytes. Should be word aligned. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>Offset in bytes to be applied when writing to the block. For example, if within a block of 100 bytes, application wishes to write 20 bytes at offset of 12, then this field should be set to 12. Should be word aligned.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_PARAM</td><td>if invalid parameters are passed to the API. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_ADDR</td><td>in case data address 'p_src' is not aligned. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NO_MEM</td><td>in case request cannot be processed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>No copy of the data is made, and hence memory provided for data source to be written to flash cannot be freed or reused by the application until this procedure is complete. End of this procedure is notified to the application using the notification callback registered by the application. </dd></dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l00941">941</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__nosd_8c_source.html#l00162">app_notify()</a>, <a class="el" href="pstorage_8c_source.html#l00061">BLOCK_ID_RANGE_CHECK</a>, <a class="el" href="pstorage_8c_source.html#l00312">cmd_queue_enqueue()</a>, <a class="el" href="pstorage_8c_source.html#l00050">MODULE_ID_RANGE_CHECK</a>, <a class="el" href="nrf__error_8h_source.html#l00044">NRF_ERROR_INVALID_ADDR</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, <a class="el" href="pstorage_8c_source.html#l00100">OFFSET_CHECK</a>, <a class="el" href="pstorage_8h_source.html#l00042">PSTORAGE_STORE_OP_CODE</a>, <a class="el" href="pstorage_8c_source.html#l00091">SIZE_CHECK</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;{</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_src);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_dest);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <a class="code" href="group__api__param__check.html#gaae9da1fe8e7ab5ff48f1bfec1a3e021a" title="Verifies the module identifier supplied by the application is within permissible range. ">MODULE_ID_RANGE_CHECK</a>(p_dest);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <a class="code" href="group__api__param__check.html#gac113d37e10e428c70c18b974d0e1aba6" title="Verifies the block identifier supplied by the application is within the permissible range...">BLOCK_ID_RANGE_CHECK</a>(p_dest);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <a class="code" href="group__api__param__check.html#ga411cb019552dba20f70efe942571c06a" title="Verifies size parameter provided by application in API. ">SIZE_CHECK</a>(p_dest, size);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <a class="code" href="group__api__param__check.html#ga7422f4fbd01befcc308edfcbd75b066c" title="Verifies offset parameter provided by application in API. ">OFFSET_CHECK</a>(p_dest, offset,size);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// Verify word alignment.</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned(p_src)) || (!is_word_aligned((<span class="keywordtype">void</span> *)(uint32_t)offset)))</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned((uint32_t *)p_dest-&gt;block_id)))</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__utility__functions.html#ga161eddb644ed938b9341102ac2237844" title="Routine to enqueue a flash access operation. ">cmd_queue_enqueue</a>(<a class="code" href="group__ps__opcode.html#gad1415b8815fc4e0ba8f4f6bc2d8e3ce6">PSTORAGE_STORE_OP_CODE</a>, p_dest, p_src, size, offset);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga0316f640da7481e9bd03ed51b29a3e65"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_update </td>
          <td>(</td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Routine to update persistently stored data of length 'size' contained in 'p_src' address in storage module at 'p_dest' address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_dest</td><td>Destination address where data is to be updated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_src</td><td>Source address containing data to be stored. API assumes this to be resident memory and no intermediate copy of data is made by the API. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of data to be stored expressed in bytes. Should be word aligned. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>Offset in bytes to be applied when writing to the block. For example, if within a block of 100 bytes, application wishes to write 20 bytes at offset of 12, then this field should be set to 12. Should be word aligned.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_PARAM</td><td>if invalid parameters are passed to the API. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_ADDR</td><td>in case data address 'p_src' is not aligned. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NO_MEM</td><td>in case request cannot be processed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>No copy of the data is made, and hence memory provided for data source to be written to flash cannot be freed or reused by the application until this procedure is complete. End of this procedure is notified to the application using the notification callback registered by the application.</dd></dl>
<p>Routine to update persistently stored data of length 'size' contained in 'p_src' address in storage module at 'p_dest' address.</p>
<hr/>
<p> | Page1 | |_______________________________________________| | head | body (to be updated ) | tail | |______|_________________________________|______|</p>
<hr/>
<p> | Page1 | Page2 | |_______________________________________________|______________________________________| | head | body (to be updated ) | tail | |________________|________________________________________|____________________________|</p>
<p>ToDo: pointers not uint32_t for addresses </p>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l00969">969</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__nosd_8c_source.html#l00162">app_notify()</a>, <a class="el" href="pstorage_8c_source.html#l00061">BLOCK_ID_RANGE_CHECK</a>, <a class="el" href="pstorage_8c_source.html#l00312">cmd_queue_enqueue()</a>, <a class="el" href="pstorage_8c_source.html#l00050">MODULE_ID_RANGE_CHECK</a>, <a class="el" href="nrf__error_8h_source.html#l00044">NRF_ERROR_INVALID_ADDR</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, <a class="el" href="pstorage_8c_source.html#l00100">OFFSET_CHECK</a>, <a class="el" href="pstorage__nosd_8c_source.html#l00103">PAGE_BASE_ADDR</a>, <a class="el" href="pstorage_8h_source.html#l00045">PSTORAGE_UPDATE_OP_CODE</a>, <a class="el" href="pstorage_8c_source.html#l00091">SIZE_CHECK</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;{</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_src);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_dest);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <a class="code" href="group__api__param__check.html#gaae9da1fe8e7ab5ff48f1bfec1a3e021a" title="Verifies the module identifier supplied by the application is within permissible range. ">MODULE_ID_RANGE_CHECK</a>(p_dest);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <a class="code" href="group__api__param__check.html#gac113d37e10e428c70c18b974d0e1aba6" title="Verifies the block identifier supplied by the application is within the permissible range...">BLOCK_ID_RANGE_CHECK</a>(p_dest);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <a class="code" href="group__api__param__check.html#ga411cb019552dba20f70efe942571c06a" title="Verifies size parameter provided by application in API. ">SIZE_CHECK</a>(p_dest, size);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="group__api__param__check.html#ga7422f4fbd01befcc308edfcbd75b066c" title="Verifies offset parameter provided by application in API. ">OFFSET_CHECK</a>(p_dest, offset, size);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">// Verify word alignment.</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned(p_src)) || (!is_word_aligned((<span class="keywordtype">void</span> *)(uint32_t)offset)))</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    }</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned((uint32_t *)p_dest-&gt;block_id)))</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__utility__functions.html#ga161eddb644ed938b9341102ac2237844" title="Routine to enqueue a flash access operation. ">cmd_queue_enqueue</a>(<a class="code" href="group__ps__opcode.html#gae66936fc791b79a9f85a7058ea83423a">PSTORAGE_UPDATE_OP_CODE</a>, p_dest, p_src, size, offset);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga99402440650cc2d2ee63d8866760a25b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_load </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Routine to load persistently stored data of length 'size' from 'p_src' address to 'p_dest' address; Equivalent to Storage Read. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_dest</td><td>Destination address where persistently stored data is to be loaded. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_src</td><td>Source from where data is to be loaded from persistent memory. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of data to be loaded from persistent memory expressed in bytes. Should be word aligned. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>Offset in bytes to be applied when loading from the block. For example, if within a block of 100 bytes, application wishes to load 20 bytes from offset of 12, then this field should be set to 12. Should be word aligned.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_PARAM</td><td>if invalid parameters are passed to the API. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_ADDR</td><td>in case data address 'p_dst' is not aligned. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NO_MEM</td><td>in case request cannot be processed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l00997">997</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__nosd_8c_source.html#l00162">app_notify()</a>, <a class="el" href="pstorage_8c_source.html#l00061">BLOCK_ID_RANGE_CHECK</a>, <a class="el" href="pstorage__mod_8c_source.html#l00164">pstorage_module_table_t::cb</a>, <a class="el" href="pstorage_8c_source.html#l00050">MODULE_ID_RANGE_CHECK</a>, <a class="el" href="nrf__error_8h_source.html#l00044">NRF_ERROR_INVALID_ADDR</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, <a class="el" href="pstorage_8c_source.html#l00100">OFFSET_CHECK</a>, <a class="el" href="pstorage_8h_source.html#l00043">PSTORAGE_LOAD_OP_CODE</a>, <a class="el" href="pstorage_8c_source.html#l00091">SIZE_CHECK</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;{</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_src);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_dest);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <a class="code" href="group__api__param__check.html#gaae9da1fe8e7ab5ff48f1bfec1a3e021a" title="Verifies the module identifier supplied by the application is within permissible range. ">MODULE_ID_RANGE_CHECK</a>(p_src);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <a class="code" href="group__api__param__check.html#gac113d37e10e428c70c18b974d0e1aba6" title="Verifies the block identifier supplied by the application is within the permissible range...">BLOCK_ID_RANGE_CHECK</a>(p_src);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <a class="code" href="group__api__param__check.html#ga411cb019552dba20f70efe942571c06a" title="Verifies size parameter provided by application in API. ">SIZE_CHECK</a>(p_src, size);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <a class="code" href="group__api__param__check.html#ga7422f4fbd01befcc308edfcbd75b066c" title="Verifies offset parameter provided by application in API. ">OFFSET_CHECK</a>(p_src, offset, size);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="comment">// Verify word alignment.</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned(p_dest)) || (!is_word_aligned((<span class="keywordtype">void</span> *)(uint32_t)offset)))</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned((uint32_t *)p_src-&gt;block_id)))</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    memcpy(p_dest, (((uint8_t *)p_src-&gt;block_id) + offset), size);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[p_src-&gt;module_id].<a class="code" href="structpstorage__module__table__t.html#ab8f4b0c725d674a9bea99f4dea529a4d">cb</a>(p_src, <a class="code" href="group__ps__opcode.html#ga4e04e36e3adf60869073dce4af46b7d5">PSTORAGE_LOAD_OP_CODE</a>, <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>, p_dest, size);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga64d9814f864c3f771a99eb7574e87dd0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_clear </td>
          <td>(</td>
          <td class="paramtype">pstorage_handle_t *&#160;</td>
          <td class="paramname"><em>p_base_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pstorage_size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Routine to clear data in persistent memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_base_id</td><td>Base block identifier in persistent memory that needs to cleared; Equivalent to an Erase Operation.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>Size of data to be cleared from persistent memory expressed in bytes. This parameter is to provision for clearing of certain blocks of memory, or all memory blocks in a registered module. If the total size of the application module is used (blocks * block size) in combination with the identifier for the first block in the module, all blocks in the module will be erased.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_PARAM</td><td>if invalid parameters are passed to the API. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_ADDR</td><td>in case data address 'p_dst' is not aligned. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NO_MEM</td><td>in case request cannot be processed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Clear operations may take time. This API however, does not block until the clear procedure is complete. Application is notified of procedure completion using notification callback registered by the application. 'result' parameter of the callback suggests if the procedure was successful or not. </dd></dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l01029">1029</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__nosd_8c_source.html#l00162">app_notify()</a>, <a class="el" href="pstorage__mod_8c_source.html#l00165">pstorage_module_table_t::base_id</a>, <a class="el" href="pstorage_8c_source.html#l00061">BLOCK_ID_RANGE_CHECK</a>, <a class="el" href="pstorage__mod_8c_source.html#l00166">pstorage_module_table_t::block_size</a>, <a class="el" href="pstorage_8c_source.html#l00312">cmd_queue_enqueue()</a>, <a class="el" href="pstorage_8c_source.html#l00050">MODULE_ID_RANGE_CHECK</a>, <a class="el" href="nrf__error_8h_source.html#l00044">NRF_ERROR_INVALID_ADDR</a>, <a class="el" href="nrf__error_8h_source.html#l00035">NRF_ERROR_INVALID_PARAM</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, <a class="el" href="pstorage_8h_source.html#l00044">PSTORAGE_CLEAR_OP_CODE</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;{</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    uint32_t retval;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_dest);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="group__api__param__check.html#gaae9da1fe8e7ab5ff48f1bfec1a3e021a" title="Verifies the module identifier supplied by the application is within permissible range. ">MODULE_ID_RANGE_CHECK</a>(p_dest);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <a class="code" href="group__api__param__check.html#gac113d37e10e428c70c18b974d0e1aba6" title="Verifies the block identifier supplied by the application is within the permissible range...">BLOCK_ID_RANGE_CHECK</a>(p_dest);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">if</span> ((!is_word_aligned((uint32_t *)p_dest-&gt;block_id)))</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        !(</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            ((p_dest-&gt;block_id - <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[p_dest-&gt;module_id].<a class="code" href="structpstorage__module__table__t.html#a145ebf201bffca896638196635538b3c">base_id</a>) %</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;             <a class="code" href="pstorage__mod_8c.html#a61d34204e440691235ecf310f87002af">m_app_table</a>[p_dest-&gt;module_id].<a class="code" href="structpstorage__module__table__t.html#aa5f40974b788988ad4b0383b3b6883ca">block_size</a>) == 0</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            )</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        )</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga0a5831cf5092e0dd43a01869676ee076" title="Invalid Parameter. ">NRF_ERROR_INVALID_PARAM</a>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    }</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    retval = <a class="code" href="group__utility__functions.html#ga161eddb644ed938b9341102ac2237844" title="Routine to enqueue a flash access operation. ">cmd_queue_enqueue</a>(<a class="code" href="group__ps__opcode.html#gaf2ce8b4e460358a23ae82516167df79c">PSTORAGE_CLEAR_OP_CODE</a>, p_dest, NULL, size, 0);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga1553a4d6d6d8ddf070d0eb4960b72d62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t pstorage_access_status_get </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>p_count</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>API to get status of number of pending operations with the module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">p_count</td><td>Number of storage operations pending with the module, if 0, there are no outstanding requests.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>on success, else an error code indicating reason for failure. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>is returned is API is called without module initialization. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>if NULL parameter has been passed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pstorage__mod_8c_source.html#l01059">1059</a> of file <a class="el" href="pstorage__mod_8c_source.html">pstorage_mod.c</a>.</p>

<p>References <a class="el" href="pstorage__mod_8c_source.html#l00214">cmd_queue_t::count</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="pstorage_8c_source.html#l00040">NULL_PARAM_CHECK</a>, and <a class="el" href="pstorage_8c_source.html#l00128">VERIFY_MODULE_INITIALIZED</a>.</p>
<div class="fragment"><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;{</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="pstorage__mod_8c.html#a6e4917fcb7e2eca587b8114a78a5e184" title="Verify module&#39;s initialization status. ">VERIFY_MODULE_INITIALIZED</a>();</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <a class="code" href="group__api__param__check.html#gadc3e2547b67be7deaa8497592f86e156" title="Check if the input pointer is NULL, if it is returns NRF_ERROR_NULL. ">NULL_PARAM_CHECK</a>(p_count);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    (*p_count) = <a class="code" href="pstorage__mod_8c.html#aa4316c8dd50f357ae5f6b4d5c8c2e85a">m_cmd_queue</a>.<a class="code" href="structcmd__queue__t.html#a20302e2c99a60d3f612dba57e3f6333b">count</a>;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
