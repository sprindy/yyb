<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: Connection Parameters Negotiation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__ble__sdk__lib__conn__params.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Connection Parameters Negotiation</div>  </div>
</div><!--header-->
<div class="contents">

<p>Module for initiating and executing a connection parameters negotiation procedure.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structble__conn__params__evt__t.html">ble_conn_params_evt_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connection Parameters Module event.  <a href="structble__conn__params__evt__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structble__conn__params__init__t.html">ble_conn_params_init_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connection Parameters Module init structure. This contains all options and data needed for initialization of the connection parameters negotiation module.  <a href="structble__conn__params__init__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga252f638d4581b34315217e41606cbb64"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__sdk__lib__conn__params.html#ga252f638d4581b34315217e41606cbb64">ble_conn_params_evt_handler_t</a> )(<a class="el" href="structble__conn__params__evt__t.html">ble_conn_params_evt_t</a> *p_evt)</td></tr>
<tr class="memdesc:ga252f638d4581b34315217e41606cbb64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connection Parameters Module event handler type.  <a href="#ga252f638d4581b34315217e41606cbb64">More...</a><br/></td></tr>
<tr class="separator:ga252f638d4581b34315217e41606cbb64"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gae819a1b14dbebf447254ec41f644ec42"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__sdk__lib__conn__params.html#gae819a1b14dbebf447254ec41f644ec42">ble_conn_params_evt_type_t</a> { <a class="el" href="group__ble__sdk__lib__conn__params.html#ggae819a1b14dbebf447254ec41f644ec42a693314f30d0f73380ae2701d1094179a">BLE_CONN_PARAMS_EVT_FAILED</a>, 
<a class="el" href="group__ble__sdk__lib__conn__params.html#ggae819a1b14dbebf447254ec41f644ec42a5b92634a7d02ed858cc114e73d04d265">BLE_CONN_PARAMS_EVT_SUCCEEDED</a>
 }</td></tr>
<tr class="memdesc:gae819a1b14dbebf447254ec41f644ec42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connection Parameters Module event type.  <a href="group__ble__sdk__lib__conn__params.html#gae819a1b14dbebf447254ec41f644ec42">More...</a><br/></td></tr>
<tr class="separator:gae819a1b14dbebf447254ec41f644ec42"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gacd9789a0a4c90cfea2ba2656f6408080"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__sdk__lib__conn__params.html#gacd9789a0a4c90cfea2ba2656f6408080">ble_conn_params_init</a> (const <a class="el" href="structble__conn__params__init__t.html">ble_conn_params_init_t</a> *p_init)</td></tr>
<tr class="memdesc:gacd9789a0a4c90cfea2ba2656f6408080"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the Connection Parameters module.  <a href="#gacd9789a0a4c90cfea2ba2656f6408080">More...</a><br/></td></tr>
<tr class="separator:gacd9789a0a4c90cfea2ba2656f6408080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5f6590546ae62fdfc802236be684428f"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__sdk__lib__conn__params.html#ga5f6590546ae62fdfc802236be684428f">ble_conn_params_stop</a> (void)</td></tr>
<tr class="memdesc:ga5f6590546ae62fdfc802236be684428f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for stopping the Connection Parameters module.  <a href="#ga5f6590546ae62fdfc802236be684428f">More...</a><br/></td></tr>
<tr class="separator:ga5f6590546ae62fdfc802236be684428f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb519f12dc60f53ae42f9091522d56e7"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__sdk__lib__conn__params.html#gafb519f12dc60f53ae42f9091522d56e7">ble_conn_params_change_conn_params</a> (<a class="el" href="structble__gap__conn__params__t.html">ble_gap_conn_params_t</a> *new_params)</td></tr>
<tr class="memdesc:gafb519f12dc60f53ae42f9091522d56e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for changing the current connection parameters to a new set.  <a href="#gafb519f12dc60f53ae42f9091522d56e7">More...</a><br/></td></tr>
<tr class="separator:gafb519f12dc60f53ae42f9091522d56e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadef0873bee110db3da8b77f801177871"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__sdk__lib__conn__params.html#gadef0873bee110db3da8b77f801177871">ble_conn_params_on_ble_evt</a> (<a class="el" href="structble__evt__t.html">ble_evt_t</a> *p_ble_evt)</td></tr>
<tr class="memdesc:gadef0873bee110db3da8b77f801177871"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling the Application's BLE Stack events.  <a href="#gadef0873bee110db3da8b77f801177871">More...</a><br/></td></tr>
<tr class="separator:gadef0873bee110db3da8b77f801177871"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Module for initiating and executing a connection parameters negotiation procedure. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga252f638d4581b34315217e41606cbb64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* ble_conn_params_evt_handler_t)(<a class="el" href="structble__conn__params__evt__t.html">ble_conn_params_evt_t</a> *p_evt)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connection Parameters Module event handler type. </p>

<p>Definition at line <a class="el" href="ble__conn__params_8h_source.html#l00042">42</a> of file <a class="el" href="ble__conn__params_8h_source.html">ble_conn_params.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="gae819a1b14dbebf447254ec41f644ec42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__ble__sdk__lib__conn__params.html#gae819a1b14dbebf447254ec41f644ec42">ble_conn_params_evt_type_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connection Parameters Module event type. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="ggae819a1b14dbebf447254ec41f644ec42a693314f30d0f73380ae2701d1094179a"></a>BLE_CONN_PARAMS_EVT_FAILED</em>&nbsp;</td><td class="fielddoc">
<p>Negotiation procedure failed. </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="ggae819a1b14dbebf447254ec41f644ec42a5b92634a7d02ed858cc114e73d04d265"></a>BLE_CONN_PARAMS_EVT_SUCCEEDED</em>&nbsp;</td><td class="fielddoc">
<p>Negotiation procedure succeeded. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="ble__conn__params_8h_source.html#l00029">29</a> of file <a class="el" href="ble__conn__params_8h_source.html">ble_conn_params.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="group__ble__sdk__lib__conn__params.html#ggae819a1b14dbebf447254ec41f644ec42a693314f30d0f73380ae2701d1094179a">BLE_CONN_PARAMS_EVT_FAILED</a>   ,                                  </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="group__ble__sdk__lib__conn__params.html#ggae819a1b14dbebf447254ec41f644ec42a5b92634a7d02ed858cc114e73d04d265">BLE_CONN_PARAMS_EVT_SUCCEEDED</a>                                   </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;} <a class="code" href="group__ble__sdk__lib__conn__params.html#gae819a1b14dbebf447254ec41f644ec42" title="Connection Parameters Module event type. ">ble_conn_params_evt_type_t</a>;</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gacd9789a0a4c90cfea2ba2656f6408080"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t ble_conn_params_init </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structble__conn__params__init__t.html">ble_conn_params_init_t</a> *&#160;</td>
          <td class="paramname"><em>p_init</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for initializing the Connection Parameters module. </p>
<dl class="section note"><dt>Note</dt><dd>If the negotiation procedure should be triggered when notification/indication of any characteristic is enabled by the peer, then this function must be called after having initialized the services.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_init</td><td>This contains information needed to initialize this module.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on successful initialization, otherwise an error code. </dd></dl>

<p>Definition at line <a class="el" href="ble__conn__params_8c_source.html#l00099">99</a> of file <a class="el" href="ble__conn__params_8c_source.html">ble_conn_params.c</a>.</p>

<p>References <a class="el" href="app__timer_8c_source.html#l01013">app_timer_create()</a>, <a class="el" href="app__timer_8h_source.html#l00115">APP_TIMER_MODE_SINGLE_SHOT</a>, <a class="el" href="ble__types_8h_source.html#l00027">BLE_CONN_HANDLE_INVALID</a>, <a class="el" href="ble__conn__params_8c_source.html#l00029">m_change_param</a>, <a class="el" href="ble__conn__params_8c_source.html#l00025">m_conn_handle</a>, <a class="el" href="ble__conn__params_8c_source.html#l00027">m_conn_params_timer_id</a>, <a class="el" href="ble__conn__params_8c_source.html#l00024">m_update_count</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="ble__conn__params_8h_source.html#l00048">ble_conn_params_init_t::p_conn_params</a>, and <a class="el" href="ble__conn__params_8c_source.html#l00051">update_timeout_handler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;{</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="ble__conn__params_8c.html#a2b79f096b7084e4460748f94a61265fe">m_conn_params_config</a> = *p_init;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="ble__conn__params_8c.html#a641c3a64ffdf3e4ffa849cffa34999bb">m_change_param</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (p_init-&gt;<a class="code" href="structble__conn__params__init__t.html#ab211e40857ee8019c8fd5eabfcc12ce7">p_conn_params</a> != NULL)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="ble__conn__params_8c.html#a3742ccd776662875d2e507e5028f31d5">m_preferred_conn_params</a> = *p_init-&gt;<a class="code" href="structble__conn__params__init__t.html#ab211e40857ee8019c8fd5eabfcc12ce7">p_conn_params</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">// Set the connection params in stack</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        err_code = sd_ble_gap_ppcp_set(&amp;<a class="code" href="ble__conn__params_8c.html#a3742ccd776662875d2e507e5028f31d5">m_preferred_conn_params</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// Fetch the connection params from stack</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        err_code = sd_ble_gap_ppcp_get(&amp;<a class="code" href="ble__conn__params_8c.html#a3742ccd776662875d2e507e5028f31d5">m_preferred_conn_params</a>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="ble__conn__params_8c.html#a07ee43d70915ea4e112b7d303258840d">m_conn_handle</a>  = <a class="code" href="group___b_l_e___c_o_n_n___h_a_n_d_l_e_s.html#gacf227b9b101dbcf08eccbbaba54e48f5">BLE_CONN_HANDLE_INVALID</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="ble__conn__params_8c.html#accc8da992b21c2a2566dbcf3cf87ff48">m_update_count</a> = 0;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__app__timer.html#ga8aa81f9e8bde352865be0502c7037592" title="Function for creating a timer instance. ">app_timer_create</a>(&amp;<a class="code" href="ble__conn__params_8c.html#a412d196c6a6074ed18bad56c7757c214">m_conn_params_timer_id</a>,</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                            <a class="code" href="group__app__timer.html#ggaae9566b4f8c39bd6e7b364940ca1b73ba795e93cf3bcc214a35478b80f8e0186d">APP_TIMER_MODE_SINGLE_SHOT</a>,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                            <a class="code" href="ble__conn__params_8c.html#a358454b862e23cde209fd9a4d7d29baa">update_timeout_handler</a>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga5f6590546ae62fdfc802236be684428f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t ble_conn_params_stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for stopping the Connection Parameters module. </p>
<p>This function is intended to be used by the application to clean up the connection parameters update module. This will stop the connection parameters update timer if running, thereby preventing any impending connection parameters update procedure. This function must be called by the application when it needs to clean itself up (for example, before disabling the bluetooth SoftDevice) so that an unwanted timer expiry event can be avoided.</p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on successful initialization, otherwise an error code. </dd></dl>

<p>Definition at line <a class="el" href="ble__conn__params_8c_source.html#l00135">135</a> of file <a class="el" href="ble__conn__params_8c_source.html">ble_conn_params.c</a>.</p>

<p>References <a class="el" href="app__timer_8c_source.html#l01109">app_timer_stop()</a>, and <a class="el" href="ble__conn__params_8c_source.html#l00027">m_conn_params_timer_id</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__app__timer.html#gad40fbb2a6a9e5bf7d00f838763f5514c" title="Function for stopping the specified timer. ">app_timer_stop</a>(<a class="code" href="ble__conn__params_8c.html#a412d196c6a6074ed18bad56c7757c214">m_conn_params_timer_id</a>);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gafb519f12dc60f53ae42f9091522d56e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t ble_conn_params_change_conn_params </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structble__gap__conn__params__t.html">ble_gap_conn_params_t</a> *&#160;</td>
          <td class="paramname"><em>new_params</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for changing the current connection parameters to a new set. </p>
<p>Use this function to change the connection parameters to a new set of parameter (ie different from the ones given at init of the module). This function is usefull for scenario where most of the time the application needs a relatively big connection interval, and just sometimes, for a temporary period requires shorter connection interval, for example to transfer a higher amount of data. If the given parameters does not match the current connection's parameters this function initiates a new negotiation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">new_params</td><td>This contains the new connections parameters to setup.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on successful initialization, otherwise an error code. </dd></dl>

<p>Definition at line <a class="el" href="ble__conn__params_8c_source.html#l00294">294</a> of file <a class="el" href="ble__conn__params_8c_source.html">ble_conn_params.c</a>.</p>

<p>References <a class="el" href="ble__conn__params_8h_source.html#l00032">BLE_CONN_PARAMS_EVT_SUCCEEDED</a>, <a class="el" href="ble__conn__params_8h_source.html#l00054">ble_conn_params_init_t::evt_handler</a>, <a class="el" href="ble__conn__params_8h_source.html#l00038">ble_conn_params_evt_t::evt_type</a>, <a class="el" href="ble__conn__params_8c_source.html#l00031">is_conn_params_ok()</a>, <a class="el" href="ble__conn__params_8c_source.html#l00029">m_change_param</a>, <a class="el" href="ble__conn__params_8c_source.html#l00025">m_conn_handle</a>, <a class="el" href="ble__conn__params_8c_source.html#l00024">m_update_count</a>, and <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>.</p>
<div class="fragment"><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="ble__conn__params_8c.html#a3742ccd776662875d2e507e5028f31d5">m_preferred_conn_params</a> = *new_params;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// Set the connection params in stack</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    err_code = sd_ble_gap_ppcp_set(&amp;<a class="code" href="ble__conn__params_8c.html#a3742ccd776662875d2e507e5028f31d5">m_preferred_conn_params</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (err_code == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="ble__conn__params_8c.html#a2fabf32bb44185c07ab62bd3c34699c1">is_conn_params_ok</a>(&amp;<a class="code" href="ble__conn__params_8c.html#ab4eb8c2c567bb4cd5089b1a9f4904612">m_current_conn_params</a>))</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <a class="code" href="ble__conn__params_8c.html#a641c3a64ffdf3e4ffa849cffa34999bb">m_change_param</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            err_code = sd_ble_gap_conn_param_update(<a class="code" href="ble__conn__params_8c.html#a07ee43d70915ea4e112b7d303258840d">m_conn_handle</a>, &amp;<a class="code" href="ble__conn__params_8c.html#a3742ccd776662875d2e507e5028f31d5">m_preferred_conn_params</a>);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <a class="code" href="ble__conn__params_8c.html#accc8da992b21c2a2566dbcf3cf87ff48">m_update_count</a> = 1;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="comment">// Notify the application that the procedure has succeded</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="ble__conn__params_8c.html#a2b79f096b7084e4460748f94a61265fe">m_conn_params_config</a>.<a class="code" href="structble__conn__params__init__t.html#af6344191be6d1f66ec79d6086def25f1">evt_handler</a> != NULL)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <a class="code" href="structble__conn__params__evt__t.html" title="Connection Parameters Module event. ">ble_conn_params_evt_t</a> evt;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                evt.<a class="code" href="structble__conn__params__evt__t.html#a43fc16c6c20c00363c03e968c21c08d7">evt_type</a> = <a class="code" href="group__ble__sdk__lib__conn__params.html#ggae819a1b14dbebf447254ec41f644ec42a5b92634a7d02ed858cc114e73d04d265">BLE_CONN_PARAMS_EVT_SUCCEEDED</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <a class="code" href="ble__conn__params_8c.html#a2b79f096b7084e4460748f94a61265fe">m_conn_params_config</a>.<a class="code" href="structble__conn__params__init__t.html#af6344191be6d1f66ec79d6086def25f1">evt_handler</a>(&amp;evt);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            err_code = <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gadef0873bee110db3da8b77f801177871"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ble_conn_params_on_ble_evt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structble__evt__t.html">ble_evt_t</a> *&#160;</td>
          <td class="paramname"><em>p_ble_evt</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for handling the Application's BLE Stack events. </p>
<p>Handles all events from the BLE stack that are of interest to this module.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_ble_evt</td><td>The event received from the BLE stack. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ble__conn__params_8c_source.html#l00267">267</a> of file <a class="el" href="ble__conn__params_8c_source.html">ble_conn_params.c</a>.</p>

<p>References <a class="el" href="ble__gap_8h_source.html#l00441">BLE_GAP_EVT_CONN_PARAM_UPDATE</a>, <a class="el" href="ble__gap_8h_source.html#l00439">BLE_GAP_EVT_CONNECTED</a>, <a class="el" href="ble__gap_8h_source.html#l00440">BLE_GAP_EVT_DISCONNECTED</a>, <a class="el" href="ble__gatts_8h_source.html#l00243">BLE_GATTS_EVT_WRITE</a>, <a class="el" href="ble_8h_source.html#l00134">ble_evt_hdr_t::evt_id</a>, <a class="el" href="ble_8h_source.html#l00141">ble_evt_t::header</a>, <a class="el" href="ble__conn__params_8c_source.html#l00258">on_conn_params_update()</a>, <a class="el" href="ble__conn__params_8c_source.html#l00194">on_connect()</a>, <a class="el" href="ble__conn__params_8c_source.html#l00209">on_disconnect()</a>, and <a class="el" href="ble__conn__params_8c_source.html#l00226">on_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;{</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">switch</span> (p_ble_evt-&gt;<a class="code" href="structble__evt__t.html#a50f33abba5627a26728ba30fffd9880a">header</a>.<a class="code" href="structble__evt__hdr__t.html#a826314e7ea25d4267621899efe6859f9">evt_id</a>)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___g_a_p___s_t_r_u_c_t_u_r_e_s.html#ggada486dd3c0cce897b23a887bed284fefaa0b4789724d202a13a5e7eab85c52957">BLE_GAP_EVT_CONNECTED</a>:</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <a class="code" href="ble__conn__params_8c.html#aafc983152b1087295bd33edc9a6563e2">on_connect</a>(p_ble_evt);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___g_a_p___s_t_r_u_c_t_u_r_e_s.html#ggada486dd3c0cce897b23a887bed284fefa057001bbd6ea9e615f19ef93cc0831ee">BLE_GAP_EVT_DISCONNECTED</a>:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <a class="code" href="ble__conn__params_8c.html#affb2e84757edb1b3928ed72af7ca234a">on_disconnect</a>(p_ble_evt);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___g_a_t_t_s___s_t_r_u_c_t_u_r_e_s.html#ggae537647902af1b05c1e32f12d6b401c7aa68b7764f5264ff092d2ad17851355ed">BLE_GATTS_EVT_WRITE</a>:</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <a class="code" href="ble__conn__params_8c.html#a70525a816fec301fa4c9d564831c440b">on_write</a>(p_ble_evt);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group___b_l_e___g_a_p___s_t_r_u_c_t_u_r_e_s.html#ggada486dd3c0cce897b23a887bed284fefa9117fcf7efad580886dfad72e5d7cce7">BLE_GAP_EVT_CONN_PARAM_UPDATE</a>:</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <a class="code" href="ble__conn__params_8c.html#ab65bf20d4ddc831bd2f59d02a9055954">on_conn_params_update</a>(p_ble_evt);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="comment">// No implementation needed.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
