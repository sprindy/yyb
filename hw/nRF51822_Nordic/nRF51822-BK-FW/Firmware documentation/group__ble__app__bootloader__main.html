<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__ble__app__bootloader__main.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">main.c</div>  </div>
</div><!--header-->
<div class="contents">

<p>Bootloader project main file.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga3b95cf3b83cc132e0336162d25dd50f0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga3b95cf3b83cc132e0336162d25dd50f0">LED_R_MSK</a>&#160;&#160;&#160;(1UL &lt;&lt; LED_RGB_RED)</td></tr>
<tr class="separator:ga3b95cf3b83cc132e0336162d25dd50f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga83e38b9ed71136a5b0554e3e7f166f59"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga83e38b9ed71136a5b0554e3e7f166f59">LED_G_MSK</a>&#160;&#160;&#160;(1UL &lt;&lt; LED_RGB_GREEN)</td></tr>
<tr class="separator:ga83e38b9ed71136a5b0554e3e7f166f59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae1bc05d11c797a774394473305fc7f49"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#gae1bc05d11c797a774394473305fc7f49">LED_B_MSK</a>&#160;&#160;&#160;(1UL &lt;&lt; LED_RGB_BLUE)</td></tr>
<tr class="separator:gae1bc05d11c797a774394473305fc7f49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac0ad4bcfe8e9edf6794e9a796378978a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#gac0ad4bcfe8e9edf6794e9a796378978a">IS_SRVC_CHANGED_CHARACT_PRESENT</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:gac0ad4bcfe8e9edf6794e9a796378978a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7556c95f108bb35fc78fa4b0c4cd4ee5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga7556c95f108bb35fc78fa4b0c4cd4ee5">BOOTLOADER_BUTTON</a>&#160;&#160;&#160;BUTTON_0</td></tr>
<tr class="separator:ga7556c95f108bb35fc78fa4b0c4cd4ee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga27fae3b4fea5c7fcc6ed9bde86186f9a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga27fae3b4fea5c7fcc6ed9bde86186f9a">UPDATE_IN_PROGRESS_LED_MSK</a>&#160;&#160;&#160;(<a class="el" href="group__ble__app__bootloader__main.html#gae1bc05d11c797a774394473305fc7f49">LED_B_MSK</a>)</td></tr>
<tr class="separator:ga27fae3b4fea5c7fcc6ed9bde86186f9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7bbff5bb0ca047b109e70a831f08e217"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga7bbff5bb0ca047b109e70a831f08e217">APP_TIMER_PRESCALER</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ga7bbff5bb0ca047b109e70a831f08e217"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad5accf4f59399fd2dd980e1569deac3e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#gad5accf4f59399fd2dd980e1569deac3e">APP_TIMER_MAX_TIMERS</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:gad5accf4f59399fd2dd980e1569deac3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga756f526e607f350705dc7a2e05027cf2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga756f526e607f350705dc7a2e05027cf2">APP_TIMER_OP_QUEUE_SIZE</a>&#160;&#160;&#160;5</td></tr>
<tr class="separator:ga756f526e607f350705dc7a2e05027cf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa2008f97369b7247def4cf268d36915c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#gaa2008f97369b7247def4cf268d36915c">BUTTON_DETECTION_DELAY</a>&#160;&#160;&#160;<a class="el" href="group__app__timer.html#gafdaf90781af071b0c295cd5b2b08da3d">APP_TIMER_TICKS</a>(50, <a class="el" href="dfu__transport__ble_8c.html#a7bbff5bb0ca047b109e70a831f08e217">APP_TIMER_PRESCALER</a>)</td></tr>
<tr class="separator:gaa2008f97369b7247def4cf268d36915c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga069424fae4e23886ab0a3d0cec3f6980"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga069424fae4e23886ab0a3d0cec3f6980">SCHED_MAX_EVENT_DATA_SIZE</a>&#160;&#160;&#160;MAX(<a class="el" href="group__app__timer.html#gaadfcf671fa439bbb0f7b0f03eb4fd125">APP_TIMER_SCHED_EVT_SIZE</a>, 0)</td></tr>
<tr class="separator:ga069424fae4e23886ab0a3d0cec3f6980"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga473fb7cfbf660e0bbe6e4b8d8153e7bc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga473fb7cfbf660e0bbe6e4b8d8153e7bc">SCHED_QUEUE_SIZE</a>&#160;&#160;&#160;20</td></tr>
<tr class="separator:ga473fb7cfbf660e0bbe6e4b8d8153e7bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4df3b6dd09cac7a9c1705e80fcb735cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga4df3b6dd09cac7a9c1705e80fcb735cb">assert_nrf_callback</a> (uint16_t line_num, const uint8_t *p_file_name)</td></tr>
<tr class="memdesc:ga4df3b6dd09cac7a9c1705e80fcb735cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function for asserts in the SoftDevice.  <a href="#ga4df3b6dd09cac7a9c1705e80fcb735cb">More...</a><br/></td></tr>
<tr class="separator:ga4df3b6dd09cac7a9c1705e80fcb735cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0892e076b365fc49b55bd0f90ab09222"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga0892e076b365fc49b55bd0f90ab09222">leds_init</a> (void)</td></tr>
<tr class="memdesc:ga0892e076b365fc49b55bd0f90ab09222"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initialization of LEDs.  <a href="#ga0892e076b365fc49b55bd0f90ab09222">More...</a><br/></td></tr>
<tr class="separator:ga0892e076b365fc49b55bd0f90ab09222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga09658aaa0774820d8f25249d551bc283"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga09658aaa0774820d8f25249d551bc283">timers_init</a> (void)</td></tr>
<tr class="memdesc:ga09658aaa0774820d8f25249d551bc283"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the timer handler module (app_timer).  <a href="#ga09658aaa0774820d8f25249d551bc283">More...</a><br/></td></tr>
<tr class="separator:ga09658aaa0774820d8f25249d551bc283"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga265c25c068555fbfae4ab4f391060040"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga265c25c068555fbfae4ab4f391060040">buttons_init</a> (void)</td></tr>
<tr class="memdesc:ga265c25c068555fbfae4ab4f391060040"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the button module.  <a href="#ga265c25c068555fbfae4ab4f391060040">More...</a><br/></td></tr>
<tr class="separator:ga265c25c068555fbfae4ab4f391060040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7d572a7da8d6b8ddeabae8471710dd7c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga7d572a7da8d6b8ddeabae8471710dd7c">sys_evt_dispatch</a> (uint32_t event)</td></tr>
<tr class="memdesc:ga7d572a7da8d6b8ddeabae8471710dd7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for dispatching a BLE stack event to all modules with a BLE stack event handler.  <a href="#ga7d572a7da8d6b8ddeabae8471710dd7c">More...</a><br/></td></tr>
<tr class="separator:ga7d572a7da8d6b8ddeabae8471710dd7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga10a92dcd75860163dd80a5bee569130e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga10a92dcd75860163dd80a5bee569130e">ble_stack_init</a> (bool init_softdevice)</td></tr>
<tr class="memdesc:ga10a92dcd75860163dd80a5bee569130e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the BLE stack.  <a href="#ga10a92dcd75860163dd80a5bee569130e">More...</a><br/></td></tr>
<tr class="separator:ga10a92dcd75860163dd80a5bee569130e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa4424e1347ed274a31b0cb843878f73e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#gaa4424e1347ed274a31b0cb843878f73e">scheduler_init</a> (void)</td></tr>
<tr class="memdesc:gaa4424e1347ed274a31b0cb843878f73e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for event scheduler initialization.  <a href="#gaa4424e1347ed274a31b0cb843878f73e">More...</a><br/></td></tr>
<tr class="separator:gaa4424e1347ed274a31b0cb843878f73e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__app__bootloader__main.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:ga840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for bootloader main entry.  <a href="#ga840291bc02cba5474a4cb46a9b9566fe">More...</a><br/></td></tr>
<tr class="separator:ga840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Bootloader project main file. </p>
<ol type="1">
<li>Receive start data packet.</li>
<li>Based on start packet, prepare NVM area to store received data.</li>
<li>Receive data packet.</li>
<li>Validate data packet.</li>
<li>Write Data packet to NVM.</li>
<li>If not finished - Wait for next packet.</li>
<li>Receive stop data packet.</li>
<li>Activate Image, boot application. </li>
</ol>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga3b95cf3b83cc132e0336162d25dd50f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_R_MSK&#160;&#160;&#160;(1UL &lt;&lt; LED_RGB_RED)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Red LED bitmask </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00054">54</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga83e38b9ed71136a5b0554e3e7f166f59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_G_MSK&#160;&#160;&#160;(1UL &lt;&lt; LED_RGB_GREEN)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Green LED bitmask </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00055">55</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="gae1bc05d11c797a774394473305fc7f49"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED_B_MSK&#160;&#160;&#160;(1UL &lt;&lt; LED_RGB_BLUE)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Blue LED bitmask </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00056">56</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="gac0ad4bcfe8e9edf6794e9a796378978a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IS_SRVC_CHANGED_CHARACT_PRESENT&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Include or not the service_changed characteristic. if not enabled, the server's database cannot be changed for the lifetime of the device </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00058">58</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga7556c95f108bb35fc78fa4b0c4cd4ee5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BOOTLOADER_BUTTON&#160;&#160;&#160;BUTTON_0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Button used to enter SW update mode. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00060">60</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga27fae3b4fea5c7fcc6ed9bde86186f9a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UPDATE_IN_PROGRESS_LED_MSK&#160;&#160;&#160;(<a class="el" href="group__ble__app__bootloader__main.html#gae1bc05d11c797a774394473305fc7f49">LED_B_MSK</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Led used to indicate that DFU is active. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00061">61</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga7bbff5bb0ca047b109e70a831f08e217"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_TIMER_PRESCALER&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Value of the RTC1 PRESCALER register. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00063">63</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="gad5accf4f59399fd2dd980e1569deac3e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_TIMER_MAX_TIMERS&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of simultaneously created timers. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00064">64</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga756f526e607f350705dc7a2e05027cf2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_TIMER_OP_QUEUE_SIZE&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Size of timer operation queues. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00065">65</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="gaa2008f97369b7247def4cf268d36915c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUTTON_DETECTION_DELAY&#160;&#160;&#160;<a class="el" href="group__app__timer.html#gafdaf90781af071b0c295cd5b2b08da3d">APP_TIMER_TICKS</a>(50, <a class="el" href="dfu__transport__ble_8c.html#a7bbff5bb0ca047b109e70a831f08e217">APP_TIMER_PRESCALER</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Delay from a GPIOTE event until a button is reported as pushed (in number of timer ticks). </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00067">67</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga069424fae4e23886ab0a3d0cec3f6980"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCHED_MAX_EVENT_DATA_SIZE&#160;&#160;&#160;MAX(<a class="el" href="group__app__timer.html#gaadfcf671fa439bbb0f7b0f03eb4fd125">APP_TIMER_SCHED_EVT_SIZE</a>, 0)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum size of scheduler events. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00069">69</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga473fb7cfbf660e0bbe6e4b8d8153e7bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCHED_QUEUE_SIZE&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of events in the scheduler queue. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00071">71</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga4df3b6dd09cac7a9c1705e80fcb735cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assert_nrf_callback </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>line_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>p_file_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for asserts in the SoftDevice. </p>
<p>This function will be called in case of an assert in the SoftDevice.</p>
<dl class="section warning"><dt>Warning</dt><dd>This handler is an example only and does not fit a final product. You need to analyze how your product is supposed to react in case of Assert. </dd>
<dd>
On assert from the SoftDevice, the system can only recover on reset.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">line_num</td><td>Line number of the failing ASSERT call. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">file_name</td><td>File name of the failing ASSERT call. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00085">85</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="main_8c_source.html#l00129">app_error_handler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;{</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="group__ble__app__beacon__main.html#gad8b5b293dfa06cbbfeb03aaaaa2772cf" title="Function for error handling, which is called when an error has occurred. ">app_error_handler</a>(0xDEADBEEF, line_num, p_file_name);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga0892e076b365fc49b55bd0f90ab09222"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void leds_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for initialization of LEDs. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00093">93</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="led__softblink_8h_source.html#l00027">led_sb_init_params_t::active_high</a>, <a class="el" href="led__softblink_8h_source.html#l00021">led_sb_init_params_t::duty_cycle_max</a>, <a class="el" href="led__softblink_8h_source.html#l00022">led_sb_init_params_t::duty_cycle_min</a>, <a class="el" href="led__softblink_8h_source.html#l00023">led_sb_init_params_t::duty_cycle_step</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00056">LED_B_MSK</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00055">LED_G_MSK</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00054">LED_R_MSK</a>, <a class="el" href="led__softblink_8c_source.html#l00194">led_softblink_init()</a>, <a class="el" href="led__softblink_8h_source.html#l00026">led_sb_init_params_t::leds_pin_bm</a>, <a class="el" href="nrf__gpio_8h_source.html#l00132">nrf_gpio_cfg_output()</a>, <a class="el" href="nrf__gpio_8h_source.html#l00217">nrf_gpio_pin_set()</a>, <a class="el" href="led__softblink_8h_source.html#l00024">led_sb_init_params_t::off_time_ms</a>, and <a class="el" href="led__softblink_8h_source.html#l00025">led_sb_init_params_t::on_time_ms</a>.</p>
<div class="fragment"><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;{   </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    uint32_t             err_code;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="structled__sb__init__params__t.html">led_sb_init_params_t</a> led_sb_init_params;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="group__nrf__gpio.html#ga0271806dc37bffea02d199474d526a35" title="Function for configuring the given GPIO pin number as output with given initial value set...">nrf_gpio_cfg_output</a>(LED_RGB_RED);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="group__nrf__gpio.html#ga0271806dc37bffea02d199474d526a35" title="Function for configuring the given GPIO pin number as output with given initial value set...">nrf_gpio_cfg_output</a>(LED_RGB_GREEN);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="group__nrf__gpio.html#ga0271806dc37bffea02d199474d526a35" title="Function for configuring the given GPIO pin number as output with given initial value set...">nrf_gpio_cfg_output</a>(LED_RGB_BLUE);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="group__nrf__gpio.html#gacaf7e8e242a47f7b635bbeca5c5934a3" title="Function for setting a GPIO pin. ">nrf_gpio_pin_set</a>(LED_RGB_RED);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="group__nrf__gpio.html#gacaf7e8e242a47f7b635bbeca5c5934a3" title="Function for setting a GPIO pin. ">nrf_gpio_pin_set</a>(LED_RGB_GREEN);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="group__nrf__gpio.html#gacaf7e8e242a47f7b635bbeca5c5934a3" title="Function for setting a GPIO pin. ">nrf_gpio_pin_set</a>(LED_RGB_BLUE);    </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#af192a7d8766db12b0186d692063685d9">active_high</a>     = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#a78611e3016d5a4775f5e4a904edb6bf4">duty_cycle_max</a>  = 20;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#aa3a516ad3d8f7f8feae944d59de3fa20">duty_cycle_min</a>  = 0;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#a7013c8a50be6e455c197a850c4a38330">duty_cycle_step</a> = 1;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#a17ab324a39ce36e448e3bfaa32b9d4b0">leds_pin_bm</a>     = (<a class="code" href="group__ble__app__bootloader__main.html#ga3b95cf3b83cc132e0336162d25dd50f0">LED_R_MSK</a> | <a class="code" href="group__ble__app__bootloader__main.html#ga83e38b9ed71136a5b0554e3e7f166f59">LED_G_MSK</a> | <a class="code" href="group__ble__app__bootloader__main.html#gae1bc05d11c797a774394473305fc7f49">LED_B_MSK</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#ab6a3651e84aa1e495864358f378e05f8">off_time_ms</a>     = 2000;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    led_sb_init_params.<a class="code" href="structled__sb__init__params__t.html#ab1c4af98b6f1c345bc6d5076f16492c7">on_time_ms</a>      = 0;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    err_code = <a class="code" href="led__softblink_8c.html#a684816018bccf8059226b930cf62e8ca" title="LED softblink initialization. ">led_softblink_init</a>(&amp;led_sb_init_params);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    APP_ERROR_CHECK(err_code);        </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga09658aaa0774820d8f25249d551bc283"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void timers_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for initializing the timer handler module (app_timer). </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00121">121</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="app__timer_8h_source.html#l00143">APP_TIMER_INIT</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00064">APP_TIMER_MAX_TIMERS</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00065">APP_TIMER_OP_QUEUE_SIZE</a>, and <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00063">APP_TIMER_PRESCALER</a>.</p>
<div class="fragment"><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// Initialize timer module, making it use the scheduler.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="group__app__timer.html#ga9eb4ec72345e8b61aa833ee299a788fe" title="Macro for initializing the application timer module. ">APP_TIMER_INIT</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga7bbff5bb0ca047b109e70a831f08e217">APP_TIMER_PRESCALER</a>, <a class="code" href="group__ble__app__bootloader__main.html#gad5accf4f59399fd2dd980e1569deac3e">APP_TIMER_MAX_TIMERS</a>, <a class="code" href="group__ble__app__bootloader__main.html#ga756f526e607f350705dc7a2e05027cf2">APP_TIMER_OP_QUEUE_SIZE</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga265c25c068555fbfae4ab4f391060040"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void buttons_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for initializing the button module. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00130">130</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00060">BOOTLOADER_BUTTON</a>, <a class="el" href="nrf__gpio_8h_source.html#l00173">nrf_gpio_cfg_sense_input()</a>, and <a class="el" href="nrf__gpio_8h_source.html#l00070">NRF_GPIO_PIN_SENSE_LOW</a>.</p>
<div class="fragment"><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;{   </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="group__nrf__gpio.html#ga97fda94de057f7971c3a2ad325c66d75" title="Function for configuring the given GPIO pin number as input with given initial value set...">nrf_gpio_cfg_sense_input</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga7556c95f108bb35fc78fa4b0c4cd4ee5">BOOTLOADER_BUTTON</a>,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                             BUTTON_PULL, </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                             <a class="code" href="group__nrf__gpio.html#gga0708136c752d69015962a2ccb4c59fbda48aaaa3fc33a295d9c65f094e03aba24" title="Pin sense low level. ">NRF_GPIO_PIN_SENSE_LOW</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga7d572a7da8d6b8ddeabae8471710dd7c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sys_evt_dispatch </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>event</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for dispatching a BLE stack event to all modules with a BLE stack event handler. </p>
<p>This function is called from the scheduler in the main loop after a BLE stack event has been received.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_ble_evt</td><td>Bluetooth stack event. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00146">146</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="pstorage__mod_8c_source.html#l00429">pstorage_sys_event_handler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="group__utility__functions.html#ga11860d5ebd557b256ede4ddd5d5d5aed" title="Handles Flash Access Result Events declared in pstorage_platform.h. ">pstorage_sys_event_handler</a>(event);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga10a92dcd75860163dd80a5bee569130e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ble_stack_init </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>init_softdevice</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for initializing the BLE stack. </p>
<p>Initializes the SoftDevice and the BLE event interrupt.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">init_softdevice</td><td>true if SoftDevice should be initialized. The SoftDevice must only be initialized if a chip reset has occured. Soft reset from application must not reinitialize the SoftDevice. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00160">160</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00055">BOOTLOADER_REGION_START</a>, <a class="el" href="ble_8h_source.html#l00201">ble_enable_params_t::gatts_enable_params</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00058">IS_SRVC_CHANGED_CHARACT_PRESENT</a>, <a class="el" href="nrf__sdm_8h_source.html#l00064">NRF_CLOCK_LFCLKSRC_RC_250_PPM_8000MS_CALIBRATION</a>, <a class="el" href="nrf__mbr_8h_source.html#l00046">SD_MBR_COMMAND_INIT_SD</a>, <a class="el" href="ble__gatts_8h_source.html#l00124">ble_gatts_enable_params_t::service_changed</a>, <a class="el" href="softdevice__handler_8h_source.html#l00070">SOFTDEVICE_HANDLER_INIT</a>, <a class="el" href="softdevice__handler_8c_source.html#l00284">softdevice_sys_evt_handler_set()</a>, and <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00146">sys_evt_dispatch()</a>.</p>
<div class="fragment"><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    uint32_t         err_code;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="structsd__mbr__command__t.html">sd_mbr_command_t</a> com = {<a class="code" href="group___n_r_f___m_b_r___e_n_u_m_s.html#ggad416fbc71855eb8e1533a812164b85a7a1fcb02bcda46da19c7baff2b92c71fe5">SD_MBR_COMMAND_INIT_SD</a>, };</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span> (init_softdevice)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        err_code = sd_mbr_command(&amp;com);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    err_code = sd_softdevice_vector_table_base_set(<a class="code" href="group__nrf__dfu__types.html#ga86b4872454e09cda5b4156b2f9f5f689">BOOTLOADER_REGION_START</a>);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="group__softdevice__handler.html#ga9ff2f68caf148f0645c9953c93aa2ec7" title="Macro for initializing the stack event handler. ">SOFTDEVICE_HANDLER_INIT</a>(<a class="code" href="group___n_r_f___s_d_m___e_n_u_m_s.html#ggaef6aabaa8887cb4d7265d7e21b3ec242a2c0772805e06ad3966b4dc69abd3f247">NRF_CLOCK_LFCLKSRC_RC_250_PPM_8000MS_CALIBRATION</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// Enable BLE stack </span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="structble__enable__params__t.html" title="BLE GATTS init options. ">ble_enable_params_t</a> ble_enable_params;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    memset(&amp;ble_enable_params, 0, <span class="keyword">sizeof</span>(ble_enable_params));</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    ble_enable_params.<a class="code" href="structble__enable__params__t.html#aeb0ae8777c2b35cd985cb3505accfa4f">gatts_enable_params</a>.<a class="code" href="structble__gatts__enable__params__t.html#a887ca57e53964f933c525579f6ed1fa3">service_changed</a> = <a class="code" href="group__ble__app__bootloader__main.html#gac0ad4bcfe8e9edf6794e9a796378978a">IS_SRVC_CHANGED_CHARACT_PRESENT</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    err_code = sd_ble_enable(&amp;ble_enable_params);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    err_code = <a class="code" href="group__softdevice__handler.html#ga200d4e1f1c70a46e6de6343f0a7d84b1" title="Function for registering for System (SOC) events. ">softdevice_sys_evt_handler_set</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga7d572a7da8d6b8ddeabae8471710dd7c" title="Function for dispatching a BLE stack event to all modules with a BLE stack event handler. ">sys_evt_dispatch</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaa4424e1347ed274a31b0cb843878f73e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void scheduler_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function for event scheduler initialization. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00190">190</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="app__scheduler_8h_source.html#l00084">APP_SCHED_INIT</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00069">SCHED_MAX_EVENT_DATA_SIZE</a>, and <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00071">SCHED_QUEUE_SIZE</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="group__app__scheduler.html#gaa9670ed0053a67304c3d2d0cb3eb1333" title="Macro for initializing the event scheduler. ">APP_SCHED_INIT</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga069424fae4e23886ab0a3d0cec3f6980">SCHED_MAX_EVENT_DATA_SIZE</a>, <a class="code" href="group__ble__app__bootloader__main.html#ga473fb7cfbf660e0bbe6e4b8d8153e7bc">SCHED_QUEUE_SIZE</a>);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga840291bc02cba5474a4cb46a9b9566fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for bootloader main entry. </p>

<p>Definition at line <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00198">198</a> of file <a class="el" href="dfu_2bootloader_2main_8c_source.html">main.c</a>.</p>

<p>References <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00160">ble_stack_init()</a>, <a class="el" href="bootloader_8c_source.html#l00098">bootloader_app_is_valid()</a>, <a class="el" href="bootloader_8c_source.html#l00308">bootloader_app_start()</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00060">BOOTLOADER_BUTTON</a>, <a class="el" href="bootloader_8c_source.html#l00327">bootloader_dfu_sd_in_progress()</a>, <a class="el" href="bootloader_8c_source.html#l00343">bootloader_dfu_sd_update_continue()</a>, <a class="el" href="bootloader_8c_source.html#l00370">bootloader_dfu_sd_update_finalize()</a>, <a class="el" href="bootloader__types_8h_source.html#l00028">BOOTLOADER_DFU_START</a>, <a class="el" href="bootloader_8c_source.html#l00268">bootloader_dfu_start()</a>, <a class="el" href="bootloader_8c_source.html#l00247">bootloader_init()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00055">BOOTLOADER_REGION_START</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00130">buttons_init()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00068">CODE_PAGE_SIZE</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00065">DFU_BANK_0_REGION_START</a>, <a class="el" href="led__softblink_8c_source.html#l00141">led_softblink_start()</a>, <a class="el" href="led__softblink_8c_source.html#l00163">led_softblink_stop()</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00093">leds_init()</a>, <a class="el" href="nrf51_8h_source.html#l01298">NRF_FICR</a>, <a class="el" href="nrf__gpio_8h_source.html#l00301">nrf_gpio_pin_read()</a>, <a class="el" href="nrf51_8h_source.html#l01267">NRF_POWER</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00046">NRF_UICR_BOOT_START_ADDRESS</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00190">scheduler_init()</a>, <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00121">timers_init()</a>, and <a class="el" href="dfu_2bootloader_2main_8c_source.html#l00061">UPDATE_IN_PROGRESS_LED_MSK</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;{</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">bool</span>     dfu_start = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">bool</span>     app_reset = (<a class="code" href="group___device___peripheral___registers.html#ga736bacc5025b0c30217b06fdf6778dc3">NRF_POWER</a>-&gt;GPREGRET == <a class="code" href="group__nrf__bootloader__types.html#ga5590b8ff0089e88358e46c506f54a688">BOOTLOADER_DFU_START</a>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> (app_reset)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="group___device___peripheral___registers.html#ga736bacc5025b0c30217b06fdf6778dc3">NRF_POWER</a>-&gt;GPREGRET = 0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// This check ensures that the defined fields in the bootloader corresponds with actual</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// setting in the nRF51 chip.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    APP_ERROR_CHECK_BOOL(*((uint32_t *)<a class="code" href="group__nrf__dfu__types.html#gae4ec3580aab0657ce2c1212adec2c0b8">NRF_UICR_BOOT_START_ADDRESS</a>) == <a class="code" href="group__nrf__dfu__types.html#ga86b4872454e09cda5b4156b2f9f5f689">BOOTLOADER_REGION_START</a>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    APP_ERROR_CHECK_BOOL(<a class="code" href="group___device___peripheral___registers.html#gaf5b17d772ce3562100afd5460a22c615">NRF_FICR</a>-&gt;CODEPAGESIZE == <a class="code" href="group__nrf__dfu__types.html#ga8b56633cd2604d9fae053b04ff288841">CODE_PAGE_SIZE</a>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// Initialize.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="group__ble__app__bootloader__main.html#ga09658aaa0774820d8f25249d551bc283" title="Function for initializing the timer handler module (app_timer). ">timers_init</a>();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="group__ble__app__bootloader__main.html#ga265c25c068555fbfae4ab4f391060040" title="Function for initializing the button module. ">buttons_init</a>();</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="group__ble__app__bootloader__main.html#ga0892e076b365fc49b55bd0f90ab09222" title="Function for initialization of LEDs. ">leds_init</a>();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    (void)<a class="code" href="group__nrf__bootloader.html#gaa821efb3c4074cee13cb2a7377e793f1" title="Function for initializing the Bootloader. ">bootloader_init</a>();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__nrf__bootloader.html#ga360affe1c4d4326b4daa465dee005330" title="Function getting state of SoftDevice update in progress. After a successfull SoftDevice transfer the ...">bootloader_dfu_sd_in_progress</a>())</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <a class="code" href="led__softblink_8c.html#a2839d9167e2ea53d78cc2eb9084c45ed" title="Start blinking LED. ">led_softblink_start</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga27fae3b4fea5c7fcc6ed9bde86186f9a">UPDATE_IN_PROGRESS_LED_MSK</a>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        err_code = <a class="code" href="group__nrf__bootloader.html#ga2edc94128b91cbdc2551be36dc692ef0" title="Function for continuing the Device Firmware Update of a SoftDevice. ">bootloader_dfu_sd_update_continue</a>();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="group__ble__app__bootloader__main.html#ga10a92dcd75860163dd80a5bee569130e" title="Function for initializing the BLE stack. ">ble_stack_init</a>(!app_reset);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <a class="code" href="group__ble__app__bootloader__main.html#gaa4424e1347ed274a31b0cb843878f73e" title="Function for event scheduler initialization. ">scheduler_init</a>();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        err_code = <a class="code" href="group__nrf__bootloader.html#ga252165c548d698c2f001261314fecfce" title="Function for finalizing the Device Firmware Update of a SoftDevice. ">bootloader_dfu_sd_update_finalize</a>();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <a class="code" href="led__softblink_8c.html#af36d187293bf5474ea6b735bac1e042f" title="Stop blinking LED. ">led_softblink_stop</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga27fae3b4fea5c7fcc6ed9bde86186f9a">UPDATE_IN_PROGRESS_LED_MSK</a>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment">// If stack is present then continue initialization of bootloader.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <a class="code" href="group__ble__app__bootloader__main.html#ga10a92dcd75860163dd80a5bee569130e" title="Function for initializing the BLE stack. ">ble_stack_init</a>(!app_reset);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <a class="code" href="group__ble__app__bootloader__main.html#gaa4424e1347ed274a31b0cb843878f73e" title="Function for event scheduler initialization. ">scheduler_init</a>();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    dfu_start  = app_reset;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    dfu_start |= ((<a class="code" href="group__nrf__gpio.html#ga0983906029818d8aa199b71b578d1c12" title="Function for reading the input level of a GPIO pin. ">nrf_gpio_pin_read</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga7556c95f108bb35fc78fa4b0c4cd4ee5">BOOTLOADER_BUTTON</a>) == 0) ? <span class="keyword">true</span>: <span class="keyword">false</span>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span> (dfu_start || (!<a class="code" href="group__nrf__bootloader.html#gabd325fffda0cb29f1a8b917eb61d2494" title="Function for validating application region in flash. ">bootloader_app_is_valid</a>(<a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>)))</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="led__softblink_8c.html#a2839d9167e2ea53d78cc2eb9084c45ed" title="Start blinking LED. ">led_softblink_start</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga27fae3b4fea5c7fcc6ed9bde86186f9a">UPDATE_IN_PROGRESS_LED_MSK</a>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">// Initiate an update of the firmware.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        err_code = <a class="code" href="group__nrf__bootloader.html#gaf11a485218863db81385fe18437b5961" title="Function for starting the Device Firmware Update. ">bootloader_dfu_start</a>();</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <a class="code" href="led__softblink_8c.html#af36d187293bf5474ea6b735bac1e042f" title="Stop blinking LED. ">led_softblink_stop</a>(<a class="code" href="group__ble__app__bootloader__main.html#ga27fae3b4fea5c7fcc6ed9bde86186f9a">UPDATE_IN_PROGRESS_LED_MSK</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__nrf__bootloader.html#gabd325fffda0cb29f1a8b917eb61d2494" title="Function for validating application region in flash. ">bootloader_app_is_valid</a>(<a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>))</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// Select a bank region to use as application region.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// @note: Only applications running from DFU_BANK_0_REGION_START is supported.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <a class="code" href="group__nrf__bootloader.html#ga4fc5191d040a4abb9a23b52e22f56101" title="Function for exiting bootloader and booting into application. ">bootloader_app_start</a>(<a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    NVIC_SystemReset();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
