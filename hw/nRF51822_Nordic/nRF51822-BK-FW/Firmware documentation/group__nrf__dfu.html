<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>nRF51822 Beacon Firmware Documentation: Device Firmware Update API.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF51822 Beacon Firmware Documentation
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__nrf__dfu.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Device Firmware Update API.</div>  </div>
</div><!--header-->
<div class="contents">

<p>Device Firmware Update module interface.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__nrf__dfu__types"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu__types.html">Types and definitions.</a></td></tr>
<tr class="memdesc:group__nrf__dfu__types"><td class="mdescLeft">&#160;</td><td class="mdescRight">Device Firmware Update module type and definitions. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__nrf__dfu__init__template"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu__init__template.html">Template file with an DFU init packet handling example.</a></td></tr>
<tr class="memdesc:group__nrf__dfu__init__template"><td class="mdescLeft">&#160;</td><td class="mdescRight">This file contains a template on how to implement DFU init packet handling. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaacc31c43e887f7b9f1f462b39f5171c2"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaacc31c43e887f7b9f1f462b39f5171c2">dfu_callback_t</a> )(uint32_t packet, uint32_t result, uint8_t *p_data)</td></tr>
<tr class="memdesc:gaacc31c43e887f7b9f1f462b39f5171c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">DFU event callback for asynchronous calls.  <a href="#gaacc31c43e887f7b9f1f462b39f5171c2">More...</a><br/></td></tr>
<tr class="separator:gaacc31c43e887f7b9f1f462b39f5171c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga04aa562312c46cd022b4d4acc7318452"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga04aa562312c46cd022b4d4acc7318452">dfu_init</a> (void)</td></tr>
<tr class="memdesc:ga04aa562312c46cd022b4d4acc7318452"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for initializing the Device Firmware Update module.  <a href="#ga04aa562312c46cd022b4d4acc7318452">More...</a><br/></td></tr>
<tr class="separator:ga04aa562312c46cd022b4d4acc7318452"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac459a6787392cac2da15bc87ce7b99c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gac459a6787392cac2da15bc87ce7b99c9">dfu_register_callback</a> (<a class="el" href="group__nrf__dfu.html#gaacc31c43e887f7b9f1f462b39f5171c2">dfu_callback_t</a> callback_handler)</td></tr>
<tr class="memdesc:gac459a6787392cac2da15bc87ce7b99c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for registering a callback listener for <a class="el" href="group__nrf__dfu.html#gaedeca60961c137dbc070c9acba09126f">dfu_data_pkt_handle</a> callbacks.  <a href="#gac459a6787392cac2da15bc87ce7b99c9">More...</a><br/></td></tr>
<tr class="separator:gac459a6787392cac2da15bc87ce7b99c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ca360d2f4d3e5847815e3b78ee00786"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga3ca360d2f4d3e5847815e3b78ee00786">dfu_start_pkt_handle</a> (<a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *p_packet)</td></tr>
<tr class="memdesc:ga3ca360d2f4d3e5847815e3b78ee00786"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for setting the DFU image size.  <a href="#ga3ca360d2f4d3e5847815e3b78ee00786">More...</a><br/></td></tr>
<tr class="separator:ga3ca360d2f4d3e5847815e3b78ee00786"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaedeca60961c137dbc070c9acba09126f"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaedeca60961c137dbc070c9acba09126f">dfu_data_pkt_handle</a> (<a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *p_packet)</td></tr>
<tr class="memdesc:gaedeca60961c137dbc070c9acba09126f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling DFU data packets.  <a href="#gaedeca60961c137dbc070c9acba09126f">More...</a><br/></td></tr>
<tr class="separator:gaedeca60961c137dbc070c9acba09126f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a7187ec97973d70e1f0d3d9a1747052"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga0a7187ec97973d70e1f0d3d9a1747052">dfu_init_pkt_handle</a> (<a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *p_packet)</td></tr>
<tr class="memdesc:ga0a7187ec97973d70e1f0d3d9a1747052"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling DFU init packets.  <a href="#ga0a7187ec97973d70e1f0d3d9a1747052">More...</a><br/></td></tr>
<tr class="separator:ga0a7187ec97973d70e1f0d3d9a1747052"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga025b98379882ab47f9a2585dce60e34c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga025b98379882ab47f9a2585dce60e34c">dfu_image_validate</a> (void)</td></tr>
<tr class="memdesc:ga025b98379882ab47f9a2585dce60e34c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating a transferred image after the transfer has completed.  <a href="#ga025b98379882ab47f9a2585dce60e34c">More...</a><br/></td></tr>
<tr class="separator:ga025b98379882ab47f9a2585dce60e34c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaa8227795cc1e3d231d2114f79a9017c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaaa8227795cc1e3d231d2114f79a9017c">dfu_image_activate</a> (void)</td></tr>
<tr class="memdesc:gaaa8227795cc1e3d231d2114f79a9017c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for activating the transfered image after validation has successfully completed.  <a href="#gaaa8227795cc1e3d231d2114f79a9017c">More...</a><br/></td></tr>
<tr class="separator:gaaa8227795cc1e3d231d2114f79a9017c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3428f74b8abe841939414cd8669dc017"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga3428f74b8abe841939414cd8669dc017">dfu_reset</a> (void)</td></tr>
<tr class="memdesc:ga3428f74b8abe841939414cd8669dc017"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for reseting the current update procedure and return to initial state.  <a href="#ga3428f74b8abe841939414cd8669dc017">More...</a><br/></td></tr>
<tr class="separator:ga3428f74b8abe841939414cd8669dc017"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga46075f420f41e2c6fe102a07e0def6e9"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga46075f420f41e2c6fe102a07e0def6e9">dfu_bl_image_validate</a> (void)</td></tr>
<tr class="memdesc:ga46075f420f41e2c6fe102a07e0def6e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating that new bootloader has been correctly installed.  <a href="#ga46075f420f41e2c6fe102a07e0def6e9">More...</a><br/></td></tr>
<tr class="separator:ga46075f420f41e2c6fe102a07e0def6e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4d1fb87fd6d01940f8c69cfc08d74cb9"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga4d1fb87fd6d01940f8c69cfc08d74cb9">dfu_sd_image_validate</a> (void)</td></tr>
<tr class="memdesc:ga4d1fb87fd6d01940f8c69cfc08d74cb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for validating that new SoftDevicehas been correctly installed.  <a href="#ga4d1fb87fd6d01940f8c69cfc08d74cb9">More...</a><br/></td></tr>
<tr class="separator:ga4d1fb87fd6d01940f8c69cfc08d74cb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa5c719005d3cb149dc8af672c8782037"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gaa5c719005d3cb149dc8af672c8782037">dfu_bl_image_swap</a> (void)</td></tr>
<tr class="memdesc:gaa5c719005d3cb149dc8af672c8782037"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for swapping existing bootloader with newly received.  <a href="#gaa5c719005d3cb149dc8af672c8782037">More...</a><br/></td></tr>
<tr class="separator:gaa5c719005d3cb149dc8af672c8782037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac5f2b2c8faf704d6e2be18df05ceee1b"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#gac5f2b2c8faf704d6e2be18df05ceee1b">dfu_sd_image_swap</a> (void)</td></tr>
<tr class="memdesc:gac5f2b2c8faf704d6e2be18df05ceee1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for swapping existing SoftDevice with newly received.  <a href="#gac5f2b2c8faf704d6e2be18df05ceee1b">More...</a><br/></td></tr>
<tr class="separator:gac5f2b2c8faf704d6e2be18df05ceee1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7029a93e35d44f50a82aacd001069893"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrf__dfu.html#ga7029a93e35d44f50a82aacd001069893">dfu_init_pkt_complete</a> (void)</td></tr>
<tr class="memdesc:ga7029a93e35d44f50a82aacd001069893"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for handling DFU init packet complete.  <a href="#ga7029a93e35d44f50a82aacd001069893">More...</a><br/></td></tr>
<tr class="separator:ga7029a93e35d44f50a82aacd001069893"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Device Firmware Update module interface. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gaacc31c43e887f7b9f1f462b39f5171c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* dfu_callback_t)(uint32_t packet, uint32_t result, uint8_t *p_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>DFU event callback for asynchronous calls. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">packet</td><td>Packet type for which this callback is related. START_PACKET, DATA_PACKET. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">result</td><td>Operation result code. NRF_SUCCESS when a queued operation was successful. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_data</td><td>Pointer to the data to which the operation is related. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu_8h_source.html#l00035">35</a> of file <a class="el" href="dfu_8h_source.html">dfu.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga04aa562312c46cd022b4d4acc7318452"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for initializing the Device Firmware Update module. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00303">303</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="app__timer_8c_source.html#l01013">app_timer_create()</a>, <a class="el" href="app__timer_8h_source.html#l00115">APP_TIMER_MODE_SINGLE_SHOT</a>, <a class="el" href="app__timer_8c_source.html#l01080">app_timer_start()</a>, <a class="el" href="pstorage_8h_source.html#l00085">pstorage_module_param_t::cb</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00065">DFU_BANK_0_REGION_START</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00066">DFU_BANK_1_REGION_START</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00034">DFU_STATE_IDLE</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00033">DFU_STATE_INIT_ERROR</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00097">dfu_timeout_handler()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00044">DFU_TIMEOUT_INTERVAL</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00052">m_data_received</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00043">m_dfu_timer_id</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00041">m_image_crc</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00040">m_init_packet_length</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00047">m_storage_handle_app</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00046">m_storage_handle_swap</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, and <a class="el" href="dfu__dual__bank_8c_source.html#l00059">pstorage_callback_handler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    uint32_t                err_code;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="structpstorage__module__param__t.html">pstorage_module_param_t</a> storage_module_param = {.<a class="code" href="structpstorage__module__param__t.html#ab8f4b0c725d674a9bea99f4dea529a4d">cb</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#ac06b13079d6ba8377eed0736c530a2d0" title="Function for handling callbacks from pstorage module. ">pstorage_callback_handler</a>};</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a> = 0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#adfc241c56dd7f007af1567c3303351c7">m_image_crc</a>          = 0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    err_code = pstorage_raw_register(&amp;storage_module_param, &amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa668c685914fdc7aad5c00ac9ad119d85">DFU_STATE_INIT_ERROR</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>.block_id  = <a class="code" href="group__nrf__dfu__types.html#ga39e80d54dfce36ce719b5d546a8b1326">DFU_BANK_0_REGION_START</a>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a44f5af9763e456aea3551f638ffa0eac">m_storage_handle_swap</a>          = <a class="code" href="dfu__dual__bank__mod_8c.html#a6b3f1c9689128450bf4003909457db43">m_storage_handle_app</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a44f5af9763e456aea3551f638ffa0eac">m_storage_handle_swap</a>.block_id = <a class="code" href="group__nrf__dfu__types.html#ga5421283a7de3ec7880344d6e4298f6ee">DFU_BANK_1_REGION_START</a>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// Create the timer to monitor the activity by the peer doing the firmware update.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    err_code = <a class="code" href="group__app__timer.html#ga8aa81f9e8bde352865be0502c7037592" title="Function for creating a timer instance. ">app_timer_create</a>(&amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a3fe6be7ea6e5f34a06da0e43ce6ff1a4">m_dfu_timer_id</a>,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                <a class="code" href="group__app__timer.html#ggaae9566b4f8c39bd6e7b364940ca1b73ba795e93cf3bcc214a35478b80f8e0186d">APP_TIMER_MODE_SINGLE_SHOT</a>,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                <a class="code" href="dfu__dual__bank__mod_8c.html#af94b4625aba72b5bacb4a87d2e625842" title="Function for handling the DFU timeout. ">dfu_timeout_handler</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// Start the DFU timer.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    err_code = <a class="code" href="group__app__timer.html#ga03fb5f5fa85d16289db0d3c15bb0f24d" title="Function for starting a timer. ">app_timer_start</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#a3fe6be7ea6e5f34a06da0e43ce6ff1a4">m_dfu_timer_id</a>, <a class="code" href="group__dfu__bank__internal.html#gac852b26871e27db5896374b80d173ed7">DFU_TIMEOUT_INTERVAL</a>, NULL);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a> = 0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a>     = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fad19963a8788de50aaf05a439c9448e7a">DFU_STATE_IDLE</a>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac459a6787392cac2da15bc87ce7b99c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dfu_register_callback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__nrf__dfu.html#gaacc31c43e887f7b9f1f462b39f5171c2">dfu_callback_t</a>&#160;</td>
          <td class="paramname"><em>callback_handler</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for registering a callback listener for <a class="el" href="group__nrf__dfu.html#gaedeca60961c137dbc070c9acba09126f">dfu_data_pkt_handle</a> callbacks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">callback_handler</td><td>Callback handler for receiving DFU events on completed operations of DFU packets. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00339">339</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__dual__bank_8c_source.html#l00050">m_data_pkt_cb</a>.</p>
<div class="fragment"><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;{</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#a01cb0b09fdb4844a87e99787e65eb3ca">m_data_pkt_cb</a> = callback_handler;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga3ca360d2f4d3e5847815e3b78ee00786"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_start_pkt_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *&#160;</td>
          <td class="paramname"><em>p_packet</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for setting the DFU image size. </p>
<p>Function sets the DFU image size. This function must be called when an update is started in order to notify the DFU of the new image size. If multiple images are to be transferred within the same update context then this function must be called with size information for each image being transfered. If an image type is not being transfered, e.g. SoftDevice but no Application , then the image size for application must be zero.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_packet</td><td>Pointer to the DFU packet containing information on DFU update process to be started.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00345">345</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__bank__internal_8h_source.html#l00080">dfu_bank_func_t::activate</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00095">dfu_start_packet_t::app_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00094">dfu_start_packet_t::bl_image_size</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00079">dfu_bank_func_t::cleared</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00068">CODE_PAGE_SIZE</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00250">dfu_activate_app()</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00287">dfu_activate_bl()</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00226">dfu_activate_sd()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00063">DFU_BL_IMAGE_MAX_SIZE</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00182">dfu_cleared_func_app()</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00173">dfu_cleared_func_swap()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00062">DFU_IMAGE_MAX_SIZE_BANKED</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00061">DFU_IMAGE_MAX_SIZE_FULL</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00139">dfu_prepare_func_app_erase()</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00159">dfu_prepare_func_swap_erase()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00034">DFU_STATE_IDLE</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00115">dfu_timer_restart()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00048">IS_UPDATING_APP</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00047">IS_UPDATING_BL</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00046">IS_UPDATING_SD</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00050">IS_WORD_SIZED</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00036">m_image_size</a>, <a class="el" href="nrf__error_8h_source.html#l00040">NRF_ERROR_DATA_SIZE</a>, <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>, <a class="el" href="nrf__error_8h_source.html#l00034">NRF_ERROR_NOT_SUPPORTED</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">dfu_update_packet_t::params</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00078">dfu_bank_func_t::prepare</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00093">dfu_start_packet_t::sd_image_size</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00114">dfu_update_packet_t::start_packet</a>.</p>
<div class="fragment"><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a> = *(p_packet-&gt;<a class="code" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">params</a>.<a class="code" href="structdfu__update__packet__t.html#ae529376749a4bd99cef868f366c6d8cd">start_packet</a>);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// Check that the requested update procedure is supported.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">// Currently the following combinations are allowed:</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// - Application</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// - SoftDevice</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// - Bootloader</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// - SoftDevice with Bootloader</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#ga3c3aedab2c56af1d09a7f08fef4209e1">IS_UPDATING_APP</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>) &amp;&amp; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        (<a class="code" href="group__dfu__bank__internal.html#gac9f752070cc5f86753dbf9345b795392">IS_UPDATING_SD</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>) || <a class="code" href="group__dfu__bank__internal.html#ga7f75359550e5d1c48c845c3a64beeff9">IS_UPDATING_BL</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>)))</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="comment">// App update is only supported independently.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaacf52836cc3860c5ffd4e129f725f138" title="Not supported. ">NRF_ERROR_NOT_SUPPORTED</a>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="group__dfu__bank__internal.html#gaa829238741c8e27c7c8a8b6d5c36a103">IS_WORD_SIZED</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>) &amp;&amp;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          <a class="code" href="group__dfu__bank__internal.html#gaa829238741c8e27c7c8a8b6d5c36a103">IS_WORD_SIZED</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a>) &amp;&amp;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          <a class="code" href="group__dfu__bank__internal.html#gaa829238741c8e27c7c8a8b6d5c36a103">IS_WORD_SIZED</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>)))</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">// Image_sizes are not a multiple of 4 (word size).</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaacf52836cc3860c5ffd4e129f725f138" title="Not supported. ">NRF_ERROR_NOT_SUPPORTED</a>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> + <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a> +</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                   <a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#aa94c71777d0fc9bce4c9b6ec1b09948a">app_image_size</a>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>.<a class="code" href="structdfu__start__packet__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a> &gt; <a class="code" href="group__nrf__dfu__types.html#ga149639b9838418166e52e5a826e4b411">DFU_BL_IMAGE_MAX_SIZE</a>)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga4c61f2b54667506e90cc296721b2e658" title="Data size exceeds limit. ">NRF_ERROR_DATA_SIZE</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#gac9f752070cc5f86753dbf9345b795392">IS_UPDATING_SD</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>))</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a> &gt; (<a class="code" href="group__nrf__dfu__types.html#gabc90b80116dbf40ae1ddb295083f52d1">DFU_IMAGE_MAX_SIZE_FULL</a>))</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga4c61f2b54667506e90cc296721b2e658" title="Data size exceeds limit. ">NRF_ERROR_DATA_SIZE</a>;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a8dcde74dd6ebf3add8a16d664f1b7a6a">prepare</a>  = <a class="code" href="dfu__dual__bank__mod_8c.html#a4378cae309fa9e631dcf8c9c4863740f" title="Function for preparing of flash before receiving SoftDevice image. ">dfu_prepare_func_app_erase</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a64703274c55080c0a7374432804d9d11">cleared</a>  = <a class="code" href="dfu__dual__bank__mod_8c.html#a6c5d147b2cd4c7c74f3633e5a691bdac" title="Function for handling behaviour when clear operation has completed. ">dfu_cleared_func_app</a>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a5afb626527f170bcf9174aea626c4cd0">activate</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#a7624bda87becd80331c53f5ddc7c66e7" title="Function for activating received SoftDevice image. ">dfu_activate_sd</a>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a> &gt; <a class="code" href="group__nrf__dfu__types.html#gaa6268d940194dff6e27f45e76513267b">DFU_IMAGE_MAX_SIZE_BANKED</a>)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga4c61f2b54667506e90cc296721b2e658" title="Data size exceeds limit. ">NRF_ERROR_DATA_SIZE</a>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a8dcde74dd6ebf3add8a16d664f1b7a6a">prepare</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#a4eacc294cba894538e2b066c05af9b29" title="Function for preparing swap before receiving application or bootloader image. ">dfu_prepare_func_swap_erase</a>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a64703274c55080c0a7374432804d9d11">cleared</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#a0288d992c1b3eba4577d3df02ba05e5e" title="Function for handling behaviour when clear operation has completed. ">dfu_cleared_func_swap</a>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#ga7f75359550e5d1c48c845c3a64beeff9">IS_UPDATING_BL</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ac5439994e2f6fb1042537c1fed855c6a">m_start_packet</a>))</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a5afb626527f170bcf9174aea626c4cd0">activate</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#a13007bebf529dcd5d583c09e09fc5a49" title="Function for activating received Bootloader image. ">dfu_activate_bl</a>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a5afb626527f170bcf9174aea626c4cd0">activate</a> = <a class="code" href="dfu__dual__bank__mod_8c.html#a6b640fb4507021d82976ee1b7a0d6a1e" title="Function for activating received Application image. ">dfu_activate_app</a>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a>)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fad19963a8788de50aaf05a439c9448e7a">DFU_STATE_IDLE</a>:</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="comment">// Valid peer activity detected. Hence restart the DFU timer.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a7acb2db272a0e8293104c7c4ab05dbd6" title="Function for restarting the DFU Timer. ">dfu_timer_restart</a>();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a8dcde74dd6ebf3add8a16d664f1b7a6a">prepare</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaedeca60961c137dbc070c9acba09126f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_data_pkt_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *&#160;</td>
          <td class="paramname"><em>p_packet</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for handling DFU data packets. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_packet</td><td>Pointer to the DFU packet.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00431">431</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00113">dfu_update_packet_t::data_packet</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00036">DFU_STATE_RDY</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00038">DFU_STATE_RX_DATA_PKT</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00037">DFU_STATE_RX_INIT_PKT</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00115">dfu_timer_restart()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00052">m_data_received</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00036">m_image_size</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00048">mp_storage_handle_active</a>, <a class="el" href="nrf__error_8h_source.html#l00040">NRF_ERROR_DATA_SIZE</a>, <a class="el" href="nrf__error_8h_source.html#l00044">NRF_ERROR_INVALID_ADDR</a>, <a class="el" href="nrf__error_8h_source.html#l00037">NRF_ERROR_INVALID_LENGTH</a>, <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>, <a class="el" href="nrf__error_8h_source.html#l00042">NRF_ERROR_NULL</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00103">dfu_data_packet_t::p_data_packet</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00102">dfu_data_packet_t::packet_length</a>, and <a class="el" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">dfu_update_packet_t::params</a>.</p>
<div class="fragment"><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;{</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    uint32_t   data_length;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    uint32_t   err_code;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    uint32_t * p_data;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (p_packet == NULL)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaf6e08e45224ec612e6c95660eb1bcfa0" title="Null Pointer. ">NRF_ERROR_NULL</a>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// Check pointer alignment.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (!is_word_aligned(p_packet-&gt;<a class="code" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">params</a>.<a class="code" href="structdfu__update__packet__t.html#a9da0f3963fd838ee9150f7a936e0196b">data_packet</a>.<a class="code" href="structdfu__data__packet__t.html#a1819aef68b8ceb1a0cbce606ca3ed90a">p_data_packet</a>))</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment">// The p_data_packet is not word aligned address.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3" title="Bad Memory Address. ">NRF_ERROR_INVALID_ADDR</a>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a>)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa43c819e2e2d6cb79f0cc3e9703df3b04">DFU_STATE_RDY</a>:</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa8d1d50d8d5174b1cead26cf34ad1daf5">DFU_STATE_RX_INIT_PKT</a>:</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa475955163ace358b9373c0b3a87ce4ec">DFU_STATE_RX_DATA_PKT</a>:</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            data_length = p_packet-&gt;<a class="code" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">params</a>.<a class="code" href="structdfu__update__packet__t.html#a9da0f3963fd838ee9150f7a936e0196b">data_packet</a>.<a class="code" href="structdfu__data__packet__t.html#a069c2e0bb681fe7d1e341b28935603f7">packet_length</a> * <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a> + data_length) &gt; <a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a>)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="comment">// The caller is trying to write more bytes into the flash than the size provided to</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="comment">// the dfu_image_size_set function. This is treated as a serious error condition and</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                <span class="comment">// an unrecoverable one. Hence point the variable mp_app_write_address to the top of</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="comment">// the flash area. This will ensure that all future application data packet writes</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="comment">// will be blocked because of the above check.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a> = 0xFFFFFFFF;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga4c61f2b54667506e90cc296721b2e658" title="Data size exceeds limit. ">NRF_ERROR_DATA_SIZE</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="comment">// Valid peer activity detected. Hence restart the DFU timer.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a7acb2db272a0e8293104c7c4ab05dbd6" title="Function for restarting the DFU Timer. ">dfu_timer_restart</a>();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            p_data = (uint32_t *)p_packet-&gt;<a class="code" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">params</a>.<a class="code" href="structdfu__update__packet__t.html#a9da0f3963fd838ee9150f7a936e0196b">data_packet</a>.<a class="code" href="structdfu__data__packet__t.html#a1819aef68b8ceb1a0cbce606ca3ed90a">p_data_packet</a>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            err_code = pstorage_raw_store(<a class="code" href="dfu__dual__bank__mod_8c.html#a0a21c12ec66e61f99824b0a24720494e">mp_storage_handle_active</a>,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                          (uint8_t *)p_data,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                          data_length,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                          <a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a> += data_length;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a> != <a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a>)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                <span class="comment">// The entire image is not received yet. More data is expected.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                err_code = <a class="code" href="group__nrf__error.html#ga59fe2a8fe184005aefa0835c7ff400fd" title="Invalid Length. ">NRF_ERROR_INVALID_LENGTH</a>;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="comment">// The entire image has been received. Return NRF_SUCCESS.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                err_code = <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga0a7187ec97973d70e1f0d3d9a1747052"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_init_pkt_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdfu__update__packet__t.html">dfu_update_packet_t</a> *&#160;</td>
          <td class="paramname"><em>p_packet</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for handling DFU init packets. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00538">538</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00113">dfu_update_packet_t::data_packet</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00036">DFU_STATE_RDY</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00037">DFU_STATE_RX_INIT_PKT</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00115">dfu_timer_restart()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00049">IMAGE_WRITE_IN_PROGRESS</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00039">m_init_packet</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00040">m_init_packet_length</a>, <a class="el" href="nrf__error_8h_source.html#l00037">NRF_ERROR_INVALID_LENGTH</a>, <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00103">dfu_data_packet_t::p_data_packet</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00102">dfu_data_packet_t::packet_length</a>, and <a class="el" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">dfu_update_packet_t::params</a>.</p>
<div class="fragment"><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;{</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    uint32_t err_code = <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    uint32_t length;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a>)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa43c819e2e2d6cb79f0cc3e9703df3b04">DFU_STATE_RDY</a>:</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa8d1d50d8d5174b1cead26cf34ad1daf5">DFU_STATE_RX_INIT_PKT</a>;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            <span class="comment">// When receiving init packet in state ready just update and fall through this case.         </span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa8d1d50d8d5174b1cead26cf34ad1daf5">DFU_STATE_RX_INIT_PKT</a>:</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="comment">// DFU initialization has been done and a start packet has been received.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#ga11fffdc6dd415319a5a8154b66a8b2ce">IMAGE_WRITE_IN_PROGRESS</a>())</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <span class="comment">// Image write is already in progress. Cannot handle an init packet now.</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="comment">// Valid peer activity detected. Hence restart the DFU timer.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a7acb2db272a0e8293104c7c4ab05dbd6" title="Function for restarting the DFU Timer. ">dfu_timer_restart</a>();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            length = p_packet-&gt;<a class="code" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">params</a>.<a class="code" href="structdfu__update__packet__t.html#a9da0f3963fd838ee9150f7a936e0196b">data_packet</a>.<a class="code" href="structdfu__data__packet__t.html#a069c2e0bb681fe7d1e341b28935603f7">packet_length</a> * <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a> + length) &gt; <span class="keyword">sizeof</span>(<a class="code" href="dfu__dual__bank__mod_8c.html#a1c48b18efe48b24a967f064ffe921e77">m_init_packet</a>))</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga59fe2a8fe184005aefa0835c7ff400fd" title="Invalid Length. ">NRF_ERROR_INVALID_LENGTH</a>;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            memcpy(&amp;<a class="code" href="dfu__dual__bank__mod_8c.html#a1c48b18efe48b24a967f064ffe921e77">m_init_packet</a>[<a class="code" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a>],</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                   &amp;p_packet-&gt;<a class="code" href="structdfu__update__packet__t.html#aa84426ba7a3f387cd2d495e2b7fdd176">params</a>.<a class="code" href="structdfu__update__packet__t.html#a9da0f3963fd838ee9150f7a936e0196b">data_packet</a>.<a class="code" href="structdfu__data__packet__t.html#a1819aef68b8ceb1a0cbce606ca3ed90a">p_data_packet</a>[0],</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                   length);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a> += length;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="comment">// Either the start packet was not received or dfu_init function was not called before.</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga025b98379882ab47f9a2585dce60e34c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_image_validate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for validating a transferred image after the transfer has completed. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00586">586</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__init__template_8c_source.html#l00130">dfu_init_postvalidate()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00038">DFU_STATE_RX_DATA_PKT</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00039">DFU_STATE_VALIDATE</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00040">DFU_STATE_WAIT_4_ACTIVATE</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00115">dfu_timer_restart()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00052">m_data_received</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00036">m_image_size</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00048">mp_storage_handle_active</a>, <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>, and <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>.</p>
<div class="fragment"><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;{</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a>)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa475955163ace358b9373c0b3a87ce4ec">DFU_STATE_RX_DATA_PKT</a>:</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fae274655cddb628140c568df6bc5f70bf">DFU_STATE_VALIDATE</a>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="comment">// Check if the application image write has finished.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#ga412c8a2eb860a4398bb6c5101ceba57d">m_data_received</a> != <a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a>)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="comment">// Image not yet fully transfered by the peer or the peer has attempted to write</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <span class="comment">// too much data. Hence the validation should fail.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                <span class="comment">// Valid peer activity detected. Hence restart the DFU timer.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a7acb2db272a0e8293104c7c4ab05dbd6" title="Function for restarting the DFU Timer. ">dfu_timer_restart</a>();</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <span class="keywordflow">if</span> (err_code == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    err_code = <a class="code" href="group__nrf__dfu__init.html#ga1926c2d8e3484641d16f9beb654ac5f1" title="DFU postvalidate call for post-checking the received image using the init packet. ...">dfu_init_postvalidate</a>((uint8_t *)<a class="code" href="dfu__dual__bank__mod_8c.html#a0a21c12ec66e61f99824b0a24720494e">mp_storage_handle_active</a>-&gt;block_id,</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                                     <a class="code" href="dfu__dual__bank__mod_8c.html#ab00a58089a8128240922402f85448953">m_image_size</a>);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                    <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                    {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                        <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa2a335037693bd40cff8c8787d3a11598">DFU_STATE_WAIT_4_ACTIVATE</a>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaaa8227795cc1e3d231d2114f79a9017c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_image_activate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for activating the transfered image after validation has successfully completed. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00629">629</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__bank__internal_8h_source.html#l00080">dfu_bank_func_t::activate</a>, <a class="el" href="app__timer_8c_source.html#l01109">app_timer_stop()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00040">DFU_STATE_WAIT_4_ACTIVATE</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00043">m_dfu_timer_id</a>, and <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>.</p>
<div class="fragment"><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;{</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    uint32_t err_code;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a>)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa2a335037693bd40cff8c8787d3a11598">DFU_STATE_WAIT_4_ACTIVATE</a>:</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="comment">// Stop the DFU Timer because the peer activity need not be monitored any longer.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            err_code = <a class="code" href="group__app__timer.html#gad40fbb2a6a9e5bf7d00f838763f5514c" title="Function for stopping the specified timer. ">app_timer_stop</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#a3fe6be7ea6e5f34a06da0e43ce6ff1a4">m_dfu_timer_id</a>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            APP_ERROR_CHECK(err_code);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a9501c0d8f1327a64b9a2bbf5a87bcdc3">m_functions</a>.<a class="code" href="structdfu__bank__func__t.html#a5afb626527f170bcf9174aea626c4cd0">activate</a>();</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga3428f74b8abe841939414cd8669dc017"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dfu_reset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for reseting the current update procedure and return to initial state. </p>
<p>This function call will result in a system reset to ensure correct system behavior. The reset will might be scheduled to execute at a later point in time to ensure pending flash operations has completed. </p>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00653">653</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00145">bootloader_dfu_update_process()</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00128">DFU_RESET</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00135">dfu_update_status_t::status_code</a>.</p>
<div class="fragment"><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;{</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="structdfu__update__status__t.html" title="Structure holding DFU complete event. ">dfu_update_status_t</a> update_status;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    update_status.<a class="code" href="structdfu__update__status__t.html#a41de75b11fc5be19acc13404c22e9d90">status_code</a> = <a class="code" href="group__nrf__dfu__types.html#gga53842ec56bb0c14aa506551bfdc0c652aa600c9698af874adb51d134f729395a5">DFU_RESET</a>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="group__nrf__bootloader.html#gaebf46c5b600b9c2a5609c7f36954adef" title="Function for processing DFU status update. ">bootloader_dfu_update_process</a>(update_status);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga46075f420f41e2c6fe102a07e0def6e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_bl_image_validate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for validating that new bootloader has been correctly installed. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS if install was successful. NRF_ERROR_NULL if the images differs. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00807">807</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader__types_8h_source.html#l00052">bootloader_settings_t::bl_image_size</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00055">BOOTLOADER_REGION_START</a>, <a class="el" href="bootloader_8c_source.html#l00382">bootloader_settings_get()</a>, <a class="el" href="nrf__mbr_8h_source.html#l00124">sd_mbr_command_t::command</a>, <a class="el" href="nrf__mbr_8h_source.html#l00129">sd_mbr_command_t::compare</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00065">DFU_BANK_0_REGION_START</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00066">DFU_BANK_1_REGION_START</a>, <a class="el" href="nrf__mbr_8h_source.html#l00083">sd_mbr_command_compare_t::len</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">sd_mbr_command_t::params</a>, <a class="el" href="nrf__mbr_8h_source.html#l00081">sd_mbr_command_compare_t::ptr1</a>, <a class="el" href="nrf__mbr_8h_source.html#l00082">sd_mbr_command_compare_t::ptr2</a>, <a class="el" href="bootloader__types_8h_source.html#l00051">bootloader_settings_t::sd_image_size</a>, <a class="el" href="bootloader__types_8h_source.html#l00054">bootloader_settings_t::sd_image_start</a>, and <a class="el" href="nrf__mbr_8h_source.html#l00047">SD_MBR_COMMAND_COMPARE</a>.</p>
<div class="fragment"><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;{</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <a class="code" href="structbootloader__settings__t.html" title="Structure holding bootloader settings for application and bank data. ">bootloader_settings_t</a> bootloader_settings;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <a class="code" href="structsd__mbr__command__t.html">sd_mbr_command_t</a>      sd_mbr_cmd;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="group__nrf__bootloader.html#ga5a5868fa37d3f3ef4cdb3cd54cb81684" title="Function for retrieving the bootloader settings. ">bootloader_settings_get</a>(&amp;bootloader_settings);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a> != 0)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        uint32_t bl_image_start = (bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> == 0) ?</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                  <a class="code" href="group__nrf__dfu__types.html#ga5421283a7de3ec7880344d6e4298f6ee">DFU_BANK_1_REGION_START</a> :</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                                  bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> +</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                                  bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#af7e471411e95448316f756e3905fdcce">command</a>             = <a class="code" href="group___n_r_f___m_b_r___e_n_u_m_s.html#ggad416fbc71855eb8e1533a812164b85a7a5199987af2f952e4af19b1a30f02dbac">SD_MBR_COMMAND_COMPARE</a>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#adc2d5ab9f29898514d35676a5b79e954">ptr1</a> = (uint32_t *)<a class="code" href="group__nrf__dfu__types.html#ga86b4872454e09cda5b4156b2f9f5f689">BOOTLOADER_REGION_START</a>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#a047e907f08ea48e67173a1a784846d94">ptr2</a> = (uint32_t *)(bl_image_start);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#a96bbf959016e4411c9e6b9812a8be60a">len</a>  = bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a> / <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">return</span> sd_mbr_command(&amp;sd_mbr_cmd);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga4d1fb87fd6d01940f8c69cfc08d74cb9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_sd_image_validate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for validating that new SoftDevicehas been correctly installed. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS if install was successful. NRF_ERROR_NULL if the images differs. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00832">832</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00382">bootloader_settings_get()</a>, <a class="el" href="nrf__mbr_8h_source.html#l00124">sd_mbr_command_t::command</a>, <a class="el" href="nrf__mbr_8h_source.html#l00129">sd_mbr_command_t::compare</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00689">dfu_sd_img_block_swap()</a>, <a class="el" href="nrf__mbr_8h_source.html#l00083">sd_mbr_command_compare_t::len</a>, <a class="el" href="nrf__error_8h_source.html#l00042">NRF_ERROR_NULL</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">sd_mbr_command_t::params</a>, <a class="el" href="nrf__mbr_8h_source.html#l00081">sd_mbr_command_compare_t::ptr1</a>, <a class="el" href="nrf__mbr_8h_source.html#l00082">sd_mbr_command_compare_t::ptr2</a>, <a class="el" href="bootloader__types_8h_source.html#l00051">bootloader_settings_t::sd_image_size</a>, <a class="el" href="bootloader__types_8h_source.html#l00054">bootloader_settings_t::sd_image_start</a>, <a class="el" href="nrf__mbr_8h_source.html#l00047">SD_MBR_COMMAND_COMPARE</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00044">SOFTDEVICE_INFORMATION</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00054">SOFTDEVICE_REGION_START</a>.</p>
<div class="fragment"><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;{</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="structbootloader__settings__t.html" title="Structure holding bootloader settings for application and bank data. ">bootloader_settings_t</a> bootloader_settings;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <a class="code" href="structsd__mbr__command__t.html">sd_mbr_command_t</a>      sd_mbr_cmd;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="group__nrf__bootloader.html#ga5a5868fa37d3f3ef4cdb3cd54cb81684" title="Function for retrieving the bootloader settings. ">bootloader_settings_get</a>(&amp;bootloader_settings);</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">if</span> (bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> == 0)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a> + bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>) &gt; bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a>)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        uint32_t sd_start        = <a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        uint32_t block_size      = (bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> - sd_start) / 2;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        uint32_t image_end       = bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> + </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                   bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        uint32_t img_block_start = bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> + 2 * block_size;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        uint32_t sd_block_start  = sd_start + 2 * block_size;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__nrf__dfu__types.html#gaab39eb82cd517f5d6b50d7b2df9c1929">SOFTDEVICE_INFORMATION</a>-&gt;softdevice_size &lt; bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaf6e08e45224ec612e6c95660eb1bcfa0" title="Null Pointer. ">NRF_ERROR_NULL</a>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dfu__dual__bank__mod_8c.html#add37ea8686866d90e3122acd659f6945">dfu_sd_img_block_swap</a>((uint32_t *)img_block_start, </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                                     (uint32_t *)sd_block_start, </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                     image_end - img_block_start, </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                     block_size);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#af7e471411e95448316f756e3905fdcce">command</a>             = <a class="code" href="group___n_r_f___m_b_r___e_n_u_m_s.html#ggad416fbc71855eb8e1533a812164b85a7a5199987af2f952e4af19b1a30f02dbac">SD_MBR_COMMAND_COMPARE</a>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#adc2d5ab9f29898514d35676a5b79e954">ptr1</a> = (uint32_t *)<a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#a047e907f08ea48e67173a1a784846d94">ptr2</a> = (uint32_t *)bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#aeae676cbe8254ec3040a3047150659f3">compare</a>.<a class="code" href="structsd__mbr__command__compare__t.html#a96bbf959016e4411c9e6b9812a8be60a">len</a>  = bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> / <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">return</span> sd_mbr_command(&amp;sd_mbr_cmd);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaa5c719005d3cb149dc8af672c8782037"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_bl_image_swap </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for swapping existing bootloader with newly received. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on succesfull swapping. For error code please refer to <a class="el" href="structsd__mbr__command__copy__bl__t.html">sd_mbr_command_copy_bl_t</a>. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00783">783</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader__types_8h_source.html#l00052">bootloader_settings_t::bl_image_size</a>, <a class="el" href="nrf__mbr_8h_source.html#l00105">sd_mbr_command_copy_bl_t::bl_len</a>, <a class="el" href="nrf__mbr_8h_source.html#l00104">sd_mbr_command_copy_bl_t::bl_src</a>, <a class="el" href="bootloader_8c_source.html#l00382">bootloader_settings_get()</a>, <a class="el" href="nrf__mbr_8h_source.html#l00124">sd_mbr_command_t::command</a>, <a class="el" href="nrf__mbr_8h_source.html#l00128">sd_mbr_command_t::copy_bl</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00065">DFU_BANK_0_REGION_START</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00066">DFU_BANK_1_REGION_START</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">sd_mbr_command_t::params</a>, <a class="el" href="bootloader__types_8h_source.html#l00051">bootloader_settings_t::sd_image_size</a>, <a class="el" href="bootloader__types_8h_source.html#l00054">bootloader_settings_t::sd_image_start</a>, and <a class="el" href="nrf__mbr_8h_source.html#l00044">SD_MBR_COMMAND_COPY_BL</a>.</p>
<div class="fragment"><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;{</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="structbootloader__settings__t.html" title="Structure holding bootloader settings for application and bank data. ">bootloader_settings_t</a> bootloader_settings;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="structsd__mbr__command__t.html">sd_mbr_command_t</a>      sd_mbr_cmd;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="group__nrf__bootloader.html#ga5a5868fa37d3f3ef4cdb3cd54cb81684" title="Function for retrieving the bootloader settings. ">bootloader_settings_get</a>(&amp;bootloader_settings);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">if</span> (bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a> != 0)</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        uint32_t bl_image_start = (bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> == 0) ?</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                  <a class="code" href="group__nrf__dfu__types.html#ga5421283a7de3ec7880344d6e4298f6ee">DFU_BANK_1_REGION_START</a> :</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                  bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> + </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                                  bootloader_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#af7e471411e95448316f756e3905fdcce">command</a>               = <a class="code" href="group___n_r_f___m_b_r___e_n_u_m_s.html#ggad416fbc71855eb8e1533a812164b85a7a56ab45130d67e73165ac12b66e8db127">SD_MBR_COMMAND_COPY_BL</a>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#a441565d9a1a123827a4500887a1fa1ab">copy_bl</a>.<a class="code" href="structsd__mbr__command__copy__bl__t.html#ae4a55ed75900bbb8aab532db03bced7b">bl_src</a> = (uint32_t *)(bl_image_start);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        sd_mbr_cmd.<a class="code" href="structsd__mbr__command__t.html#a541ec1ebd7aea6717b230d5180da0a5e">params</a>.<a class="code" href="structsd__mbr__command__t.html#a441565d9a1a123827a4500887a1fa1ab">copy_bl</a>.<a class="code" href="structsd__mbr__command__copy__bl__t.html#a9f5ad2c6c827e7da753c247ec598085d">bl_len</a> = bootloader_settings.<a class="code" href="structbootloader__settings__t.html#a157f534e1896d6c8e5339b80af58a6e4">bl_image_size</a> / <span class="keyword">sizeof</span>(uint32_t);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">return</span> sd_mbr_command(&amp;sd_mbr_cmd);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac5f2b2c8faf704d6e2be18df05ceee1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_sd_image_swap </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for swapping existing SoftDevice with newly received. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on succesfull swapping. For error code please refer to <a class="el" href="structsd__mbr__command__copy__sd__t.html">sd_mbr_command_copy_sd_t</a>. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00725">725</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="bootloader_8c_source.html#l00382">bootloader_settings_get()</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00676">dfu_copy_sd()</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00689">dfu_sd_img_block_swap()</a>, <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>, <a class="el" href="bootloader__types_8h_source.html#l00051">bootloader_settings_t::sd_image_size</a>, <a class="el" href="bootloader__types_8h_source.html#l00054">bootloader_settings_t::sd_image_start</a>, <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00044">SOFTDEVICE_INFORMATION</a>, and <a class="el" href="nrf51__beacon_2ble__app__beacon__dfu_2bootloader_2config_2dfu__types_8h_source.html#l00054">SOFTDEVICE_REGION_START</a>.</p>
<div class="fragment"><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;{</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="structbootloader__settings__t.html" title="Structure holding bootloader settings for application and bank data. ">bootloader_settings_t</a> boot_settings;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="group__nrf__bootloader.html#ga5a5868fa37d3f3ef4cdb3cd54cb81684" title="Function for retrieving the bootloader settings. ">bootloader_settings_get</a>(&amp;boot_settings);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">if</span> (boot_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> == 0)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a> + boot_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>) &gt; boot_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a>)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        uint32_t err_code;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        uint32_t sd_start        = <a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        uint32_t block_size      = (boot_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> - sd_start) / 2;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        uint32_t image_end       = boot_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> + boot_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        uint32_t img_block_start = boot_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a> + 2 * block_size;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        uint32_t sd_block_start  = sd_start + 2 * block_size;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__nrf__dfu__types.html#gaab39eb82cd517f5d6b50d7b2df9c1929">SOFTDEVICE_INFORMATION</a>-&gt;softdevice_size &lt; boot_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="comment">// This will clear a page thus ensuring the old image is invalidated before swapping.</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a69622e0a575a79baa350512c0ebd9bb7">dfu_copy_sd</a>((uint32_t *)(sd_start + block_size), </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                   (uint32_t *)(sd_start + block_size), </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                   <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            err_code = <a class="code" href="dfu__dual__bank__mod_8c.html#a69622e0a575a79baa350512c0ebd9bb7">dfu_copy_sd</a>((uint32_t *)sd_start, (uint32_t *)sd_start, <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="keywordflow">if</span> (err_code != <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dfu__dual__bank__mod_8c.html#add37ea8686866d90e3122acd659f6945">dfu_sd_img_block_swap</a>((uint32_t *)img_block_start, </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                                     (uint32_t *)sd_block_start, </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                                     image_end - img_block_start, </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                     block_size);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">if</span> (boot_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a> != 0)</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="dfu__dual__bank__mod_8c.html#a69622e0a575a79baa350512c0ebd9bb7">dfu_copy_sd</a>((uint32_t *)boot_settings.<a class="code" href="structbootloader__settings__t.html#a051f08d57eb681e16b6b5a1ae15c1820">sd_image_start</a>,</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                               (uint32_t *)<a class="code" href="group__nrf__dfu__types.html#gaab44696b85971088c0a7d999b051184a">SOFTDEVICE_REGION_START</a>, </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                               boot_settings.<a class="code" href="structbootloader__settings__t.html#ad11f43e4a4dcc74b7956338be127b843">sd_image_size</a>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga7029a93e35d44f50a82aacd001069893"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dfu_init_pkt_complete </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for handling DFU init packet complete. </p>
<dl class="section return"><dt>Returns</dt><dd>NRF_SUCCESS on success, an error_code otherwise. </dd></dl>

<p>Definition at line <a class="el" href="dfu__dual__bank__mod_8c_source.html#l00511">511</a> of file <a class="el" href="dfu__dual__bank__mod_8c_source.html">dfu_dual_bank_mod.c</a>.</p>

<p>References <a class="el" href="dfu__init__template_8c_source.html#l00057">dfu_init_prevalidate()</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00038">DFU_STATE_RX_DATA_PKT</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00037">DFU_STATE_RX_INIT_PKT</a>, <a class="el" href="dfu__bank__internal_8h_source.html#l00049">IMAGE_WRITE_IN_PROGRESS</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00035">m_dfu_state</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00039">m_init_packet</a>, <a class="el" href="dfu__dual__bank_8c_source.html#l00040">m_init_packet_length</a>, <a class="el" href="nrf__error_8h_source.html#l00036">NRF_ERROR_INVALID_STATE</a>, and <a class="el" href="nrf__error_8h_source.html#l00028">NRF_SUCCESS</a>.</p>
<div class="fragment"><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    uint32_t err_code = <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// DFU initialization has been done and a start packet has been received.</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__dfu__bank__internal.html#ga11fffdc6dd415319a5a8154b66a8b2ce">IMAGE_WRITE_IN_PROGRESS</a>())</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">// Image write is already in progress. Cannot handle an init packet now.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e" title="Invalid state, operation disallowed in this state. ">NRF_ERROR_INVALID_STATE</a>;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> == <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa8d1d50d8d5174b1cead26cf34ad1daf5">DFU_STATE_RX_INIT_PKT</a>)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        err_code = <a class="code" href="group__nrf__dfu__init.html#ga585131c480f3f4e51293e954b4c26aeb" title="DFU prevalidate call for pre-checking the received init packet. ">dfu_init_prevalidate</a>(<a class="code" href="dfu__dual__bank__mod_8c.html#a1c48b18efe48b24a967f064ffe921e77">m_init_packet</a>, <a class="code" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">if</span> (err_code == <a class="code" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123" title="Successful command. ">NRF_SUCCESS</a>)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a3094a1e41850cba934bab311af4a1e0b">m_dfu_state</a> = <a class="code" href="group__dfu__bank__internal.html#gga187dfde3b0fa8047e6c97b2317bce21fa475955163ace358b9373c0b3a87ce4ec">DFU_STATE_RX_DATA_PKT</a>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <a class="code" href="dfu__dual__bank__mod_8c.html#a3199edc3ad38b9ba7ff9db196f910b95">m_init_packet_length</a> = 0;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">return</span> err_code;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 13 2015 11:33:11 for nRF51822 Beacon Firmware Documentation by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
